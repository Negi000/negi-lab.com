<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>新月同行 Wiki (仮)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#0d1216" />
<!-- Tailwind for shared header/footer styles -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" crossorigin="anonymous" />
<script src="https://cdn.tailwindcss.com"></script>
<script>window.tailwind=window.tailwind||{};window.tailwind.config={theme:{extend:{colors:{accent:'#4ADE80'},fontFamily:{inter:['Inter','sans-serif']}}}};</script>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;margin:0;background:#0d1216;color:#e6edf3;line-height:1.5;-webkit-font-smoothing:antialiased}
:root{--c-accent:#3a8bff;--c-bgcard:#161e26;--c-border:#24303b;--c-soft:#1c2731;--w-wrap:1280px}
/* legacy header styles removed in favor of Tailwind version */
main{max-width:var(--w-wrap);margin:auto;padding:1.2rem .9rem 3rem}
.hero{display:grid;gap:1.2rem;margin-bottom:1.6rem}
@media(min-width:900px){.hero{grid-template-columns:2fr 1fr}}
.hero-card{background:var(--c-bgcard);border:1px solid var(--c-border);border-radius:14px;padding:1.2rem;position:relative;overflow:hidden}
.hero-card h1{margin:.2rem 0 .9rem;font-size:clamp(1.35rem,4.5vw,1.55rem);line-height:1.2}
.hero-card p{margin:.2rem 0 .9rem;font-size:.85rem;color:#b6c2cc}
.quick-grid{display:grid;gap:.8rem;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
.quick-grid a{display:block;text-decoration:none;background:#18232d;border:1px solid #253542;border-radius:10px;padding:.75rem .8rem;font-size:.7rem;color:#d2e7ff;font-weight:600;letter-spacing:.5px;position:relative}
.quick-grid a:hover{background:#20303a;border-color:#345266}
.ad-slot{background:#10171d;border:1px dashed #2a3a46;border-radius:10px;min-height:90px;display:flex;align-items:center;justify-content:center;font-size:.6rem;color:#567}
.section{margin:0 0 1.9rem}
.section h2{font-size:clamp(.9rem,3.5vw,1rem);margin:0 0 .9rem;border-left:4px solid var(--c-accent);padding-left:.55rem;line-height:1.1}
.flex-row{display:flex;flex-direction:column;gap:1rem}
@media(min-width:1020px){.flex-row{flex-direction:row}.flex-row > .col{flex:1}}
.card{background:var(--c-bgcard);border:1px solid var(--c-border);border-radius:12px;padding:.85rem .85rem;position:relative}
@media(min-width:760px){.card{padding:1rem .95rem}}
.card h3{margin:.1rem 0 .6rem;font-size:.8rem;letter-spacing:.5px;color:#cfe4ff}
.small{font-size:.65rem;color:#8aa0b1}
.list-plain{list-style:none;margin:0;padding:0;font-size:.68rem}
.list-plain li{padding:.35rem 0;border-bottom:1px solid #1f2a33}
.list-plain li:last-child{border-bottom:none}
.inline-count{background:#243546;padding:2px 6px;font-size:.55rem;border-radius:999px;margin-left:.4rem;color:#9ec5ff}
.stats-bar{height:6px;background:#132028;border-radius:4px;overflow:hidden;margin-top:.4rem}
.stats-bar span{display:block;height:100%;background:linear-gradient(90deg,#3a8bff,#63b7ff)}
.badge{display:inline-block;background:#24313c;border:1px solid #2e3d49;padding:2px 6px;font-size:.55rem;border-radius:7px;margin:.15rem .35rem .15rem 0;color:#8fc4ff;letter-spacing:.5px}
.countdown{font-size:.7rem;font-weight:600;color:#ffe28d}
/* 壁紙背景 + オーバーレイ */
body.has-wallpaper{background:#0d1216 center/cover no-repeat fixed;transition:background-image 0.6s ease;position:relative}
body.has-wallpaper:before{content:"";position:fixed;inset:0;background:rgba(8,12,16,.56);backdrop-filter:blur(2px);z-index:0;pointer-events:none}
header,main,footer{position:relative;z-index:1}
footer{background:#0f161c;border-top:1px solid #1a242d;padding:1.2rem .9rem;margin-top:2rem;font-size:.6rem;color:#7d94a5}
footer .inner{max-width:var(--w-wrap);margin:auto;display:flex;flex-direction:column;gap:.6rem}
/* ディスプレイギャラリー */
.display-area{position:relative;background:rgba(15,22,28,.55);backdrop-filter:blur(4px);border:1px solid #23313c;border-radius:14px;padding:1rem;margin:1.4rem 0}
.display-stage{position:relative;overflow:hidden;border-radius:10px;aspect-ratio:16/9;background:#0b1014;border:1px solid #1f2b34}
.display-stage img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s ease}
.display-stage img.active{opacity:1}
.display-controls{display:flex;justify-content:space-between;margin-top:.6rem;gap:.6rem}
.display-btn{flex:1;background:#20303a;color:#cfe2ff;border:1px solid #324754;border-radius:8px;padding:.5rem .8rem;font-size:.65rem;cursor:pointer;letter-spacing:.5px}
.display-btn:hover{background:#2a3f4b}
.display-indicators{display:flex;flex-wrap:wrap;gap:4px;margin-top:.5rem}
.display-indicators span{width:8px;height:8px;border-radius:50%;background:#2a3b46;transition:.3s}
.display-indicators span.active{background:#63b7ff;box-shadow:0 0 4px #63b7ff}
</style>
</head>
<body>
<!-- Header (mobile-first) -->
<header class="wiki-header shadow-md sticky top-0 z-50 font-inter">
  <div class="max-w-7xl mx-auto flex items-center px-3 sm:px-4 py-3 gap-4">
    <a href="/" class="text-xl sm:text-2xl font-extrabold tracking-tight hover:opacity-80 transition" style="color:#63b7ff">negi-lab.com</a>
    <button id="menuToggle" class="ml-auto inline-flex items-center justify-center w-9 h-9 rounded-md border border-[#24303b] bg-[#18232d] text-[#cfe2ff] sm:hidden" aria-label="メニュー" aria-expanded="false">≡</button>
    <nav id="mainNav" class="ml-auto hidden sm:block">
      <ul class="flex flex-col sm:flex-row gap-3 sm:gap-6 font-medium text-base items-start sm:items-center py-3 sm:py-0" data-nav-list>
        <li><a href="/#tools" class="nav-link">ツール</a></li>
        <li><a href="/site/index.html" class="nav-link">新月同行Wiki</a></li>
        <li><a href="/chars/index.html" class="nav-link">キャラ一覧</a></li>
      </ul>
    </nav>
  </div>
</header>
<style>
.wiki-header{background:#0f161c;border-bottom:1px solid #18222c}
.wiki-header .nav-link{color:#cfe2ff;transition:color .25s}
.wiki-header .nav-link:hover{color:#63b7ff}
.wiki-header.open #mainNav{display:block}
.wiki-header #mainNav{animation:navFade .25s ease}
@keyframes navFade{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
</style>
<main>
  <section class="hero">
    <div class="hero-card">
      <h1>データ主導の『新月同行』非攻略型 Wiki</h1>
      <p>攻略記事よりも、正確で体系化されたキャラクターデータ・ロム構成・スキン情報・履歴データを集約するデータベース的 Wiki を目指したプロトタイプです。</p>
      <div class="quick-grid">
        <a href="chars/index.html">キャラ図鑑</a>
        <a href="#roms">ロム図鑑(準備中)</a>
        <a href="#skins">スキン一覧(準備中)</a>
        <a href="#calc">ダメージ計算(予定)</a>
        <a href="#calendar">誕生日カレンダー(予定)</a>
        <a href="#gacha">ガチャ履歴(予定)</a>
      </div>
    </div>
    <div class="hero-side">
      <div class="ad-slot">Ad / Hero</div>
    </div>
  </section>
  <section class="section" id="display-gallery">
    <h2>ディスプレイ</h2>
    <!-- data-interval(ms), data-fade(ms), data-initial(初期ロード枚数) -->
    <div class="display-area" data-interval="8000" data-fade="800" data-initial="8">
      <div class="display-stage" id="displayStage"></div>
      <div class="display-controls">
        <button class="display-btn" id="displayPrev" aria-label="前へ">◀ 前</button>
        <button class="display-btn" id="displayNext" aria-label="次へ">次 ▶</button>
      </div>
      <div class="display-indicators" id="displayIndicators" aria-label="表示中画像インジケータ"></div>
    </div>
  </section>

  <section class="section" id="today">
    <h2>今日と近日</h2>
    <div class="flex-row">
      <div class="col card" style="min-width:260px">
        <h3>今日の誕生日</h3>
        <div id="birthday-today" class="small">読み込み中...</div>
        <div style="margin-top:.7rem"></div>
        <h3>7日以内の誕生日</h3>
        <ul id="birthday-upcoming" class="list-plain"></ul>
      </div>
      <div class="col card" style="min-width:260px">
        <h3>進行中イベント</h3>
        <div id="events-running" class="small">(未実装)</div>
        <h3 style="margin-top:1rem">カウントダウン</h3>
        <div id="event-countdowns" class="small">(未実装)</div>
      </div>
      <div class="col card" style="min-width:220px">
        <h3>統計スナップショット</h3>
        <div id="stats-attrs" class="small">属性分布 読み込み中...</div>
        <div id="stats-types" class="small" style="margin-top:.6rem">タイプ分布 読み込み中...</div>
      </div>
    </div>
  </section>

  <section class="section" id="updates">
    <h2>更新・履歴</h2>
    <div class="flex-row">
      <div class="col card" style="min-width:300px">
        <h3>最新アップデート</h3>
        <div class="small" id="latest-update">(未実装)</div>
      </div>
      <div class="col card" style="min-width:300px">
        <h3>最新ガチャ</h3>
        <div class="small" id="latest-gacha">(未実装)</div>
      </div>
      <div class="col card" style="min-width:240px">
        <h3>最近追加/修正キャラ</h3>
        <ul id="recent-chars" class="list-plain"></ul>
      </div>
    </div>
  </section>

  <section class="section" id="skins">
    <h2>スキンハイライト (準備中)</h2>
    <div class="card small">まだデータソースが揃っていないためプレースホルダです。</div>
  </section>

  <section class="section" id="tools">
    <h2>ツール (予定)</h2>
    <div class="flex-row">
      <div class="col card"><h3>ダメージ計算</h3><div class="small">キャラ基礎ステとスキル係数から期待ダメージを算出。</div></div>
      <div class="col card"><h3>誕生日カレンダー</h3><div class="small">キャラ JSON から日付集計して月表示。</div></div>
      <div class="col card"><h3>ロム構成シミュレータ</h3><div class="small">2セット+4セット効果を組合せ比較 (構想)。</div></div>
    </div>
  </section>

  <section class="section" id="ads-middle">
    <div class="ad-slot">Ad / Middle</div>
  </section>
</main>
<footer class="bg-gray-800 text-gray-300 py-10 text-center text-sm font-inter mt-10">
  <nav class="mb-3">
    <a href="/privacy-policy-unified.html" class="underline hover:text-accent mx-2">プライバシーポリシー</a>
    <a href="/terms.html" class="underline hover:text-accent mx-2">利用規約</a>
    <a href="/about.html" class="underline hover:text-accent mx-2">運営者情報</a>
    <a href="mailto:negilab.com@gmail.com" class="underline hover:text-accent mx-2">お問い合わせ</a>
    <a href="/sitemap.xml" class="underline hover:text-accent mx-2">サイトマップ</a>
  </nav>
  <div class="text-xs text-gray-400 mb-2">新月同行 Wiki (仮) - Data oriented fan project (Unofficial)</div>
  <div id="build-meta" class="text-xs">Build: {{ビルド日時}}</div>
  <div class="mt-2">&copy; 2025 negi-lab.com</div>
</footer>
<script>
// 埋め込みデータ (ビルド時に置換想定)
window.__CHAR_BIRTHDAYS__ = JSON.parse('{{キャラ誕生日JSON}}');
window.__ATTR_STATS__ = JSON.parse('{{属性統計JSON}}');
window.__TYPE_STATS__ = JSON.parse('{{タイプ統計JSON}}');
window.__RECENT_CHARS__ = JSON.parse('{{最近キャラJSON}}');
window.__WALLPAPERS__ = JSON.parse('{{壁紙JSON}}');
window.__DISPLAYS__ = JSON.parse('{{ディスプレイJSON}}');
(function(){
  const todayEl=document.getElementById('birthday-today');
  const upcomingEl=document.getElementById('birthday-upcoming');
  const now=new Date();
  const todayKey = ('0'+(now.getMonth()+1)).slice(-2)+'-'+('0'+now.getDate()).slice(-2);
  const list=window.__CHAR_BIRTHDAYS__||[];
  const today = list.filter(c=>c.md===todayKey);
  if(today.length){
    todayEl.textContent = today.map(c=>c.name).join(' / ');
  }else{
    todayEl.textContent = '誕生日キャラなし';
  }
  // 7日以内
  for(const c of list){
    const d=new Date(now.getFullYear(), c.m-1, c.d);
    let diff=(d - now)/(1000*60*60*24);
    if(diff < -1){ // 年末繰越 (年跨ぎ簡易)
      const next=new Date(now.getFullYear()+1, c.m-1, c.d);
      diff=(next-now)/(1000*60*60*24);
    }
    if(diff>=0 && diff<=7 && c.md!==todayKey){
      const li=document.createElement('li');
      li.textContent = c.name + ' ('+c.md+')';
      upcomingEl.appendChild(li);
    }
  }
  if(!upcomingEl.children.length){
    const li=document.createElement('li');li.textContent='該当なし';upcomingEl.appendChild(li);
  }
  // 簡易統計バー表示
  function renderSimple(id, stats){
    const el=document.getElementById(id);if(!el||!stats)return;
    el.innerHTML='';
    const total=stats.reduce((a,b)=>a+b.count,0)||1;
    stats.forEach(s=>{
      const row=document.createElement('div');
      row.textContent=s.name+' '+s.count;
      row.style.marginTop='.3rem';
      const bar=document.createElement('div');bar.className='stats-bar';
      const span=document.createElement('span');span.style.width=(s.count/total*100).toFixed(1)+'%';
      bar.appendChild(span);row.appendChild(bar);el.appendChild(row);
    });
  }
  renderSimple('stats-attrs', window.__ATTR_STATS__);
  renderSimple('stats-types', window.__TYPE_STATS__);
  // 最近キャラ
  const rc=window.__RECENT_CHARS__||[];const rcEl=document.getElementById('recent-chars');
  rc.slice(0,6).forEach(c=>{const li=document.createElement('li');li.textContent=c.ID+' '+c.名前;rcEl.appendChild(li);});
  // 壁紙: ランダム適用
  (function(){
    const arr = window.__WALLPAPERS__||[]; if(!arr.length) return;
    const pick = arr[Math.floor(Math.random()*arr.length)];
    document.body.classList.add('has-wallpaper');
    document.body.style.backgroundImage = `url(${pick})`;
  })();
  // ディスプレイギャラリー
  (function(){
    const arr = window.__DISPLAYS__||[]; if(!arr.length) return;
    const area = document.querySelector('.display-area');
    const interval = parseInt(area.dataset.interval)||6000;
    const fade = parseInt(area.dataset.fade)||600; // ms
  let initial = parseInt(area.dataset.initial)||8;
  if(window.innerWidth < 640) initial = Math.min(initial,4);
    const stage = document.getElementById('displayStage');
    const indicators = document.getElementById('displayIndicators');
    let idx = 0; let timer = null;
    // 初期ロード & 遅延用プレースホルダ
    arr.forEach((src,i)=>{
      const img=document.createElement('img');
      if(i < initial){
        img.src=src;
      }else{
        img.dataset.src=src;
      }
      img.alt='display '+(i+1);
      if(i===0) img.classList.add('active');
      img.style.transition='opacity '+(fade/1000)+'s ease';
      stage.appendChild(img);
      const dot=document.createElement('span');if(i===0) dot.classList.add('active');indicators.appendChild(dot);
    });
    const imgs=[...stage.querySelectorAll('img')]; const dots=[...indicators.children];
    function ensureLoaded(i){
      const im=imgs[i]; if(im && !im.src){ im.src=im.dataset.src; }
    }
    function show(n){
      idx=(n+imgs.length)%imgs.length; ensureLoaded(idx);
      imgs.forEach((im,i)=>im.classList.toggle('active',i===idx));
      dots.forEach((d,i)=>d.classList.toggle('active',i===idx));
    }
    function next(){show(idx+1);} function prev(){show(idx-1);} 
    function loop(){clearInterval(timer);timer=setInterval(()=>{next();},interval);} loop();
    document.getElementById('displayNext').addEventListener('click',()=>{next();loop();});
    document.getElementById('displayPrev').addEventListener('click',()=>{prev();loop();});
    // インジケータクリック
    dots.forEach((d,i)=>d.addEventListener('click',()=>{show(i);loop();}));
  })();
  // モバイルナビ制御
  (function(){
    const header=document.querySelector('.wiki-header');
    const btn=document.getElementById('menuToggle');
    const nav=document.getElementById('mainNav');
    if(!btn||!nav) return;
    btn.addEventListener('click',()=>{
      const open=header.classList.toggle('open');
      btn.setAttribute('aria-expanded',open?'true':'false');
      if(open){ nav.classList.remove('hidden'); } else if(window.innerWidth < 640){ nav.classList.add('hidden'); }
    });
    window.addEventListener('resize',()=>{
      if(window.innerWidth >= 640){ nav.classList.remove('hidden'); header.classList.remove('open'); btn.setAttribute('aria-expanded','false'); }
      else if(!header.classList.contains('open')){ nav.classList.add('hidden'); }
    });
  })();
})();
</script>
</body>
</html>
