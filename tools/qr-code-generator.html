<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-translate-key="qrGenerator.pageTitle">QRコード作成ツール - negi-lab.com</title>
  <meta name="description" data-translate-key="qrGenerator.metaDescription" content="テキストやURLから簡単にカスタムQRコードを生成できるツール。エラー訂正レベルも調整可能。" />
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  
  <!-- CSS Framework -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- QR Code Library (Qrious) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"
          onload="console.log('✅ Qrious読み込み完了')"
          onerror="console.warn('⚠️ Qrious読み込みエラー - フォールバックを使用')"></script>
  
  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            negi: "#65c155",
            accent: "#4ADE80"
          },
          fontFamily: { 
            inter: ["Inter", "sans-serif"] 
          }
        }
      }
    }
    window.pageTitleTranslationKey = "qrGenerator.pageTitle";
    window.metaDescriptionTranslationKey = "qrGenerator.metaDescription";
  </script>
  
  <!-- Custom Styles -->
  <style>
    .form-input, .form-select, .form-button {
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      transition: box-shadow 0.2s;
    }
    
    .form-input:focus, .form-select:focus, .form-button:focus {
      outline: none;
      box-shadow: 0 0 0 2px #4ADE80;
      border-color: #4ADE80;
    }
    
    .form-button {
      background: #4ADE80;
      color: #fff;
      transition: background 0.15s, color 0.15s;
    }
    
    .form-button:hover:not(:disabled) {
      background: #10b981;
    }
    
    .form-button:disabled {
      background: #d1d5db;
      color: #9ca3af;
      cursor: not-allowed;
    }
    
    #qrcodeOutput {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      border: 2px dashed #e2e8f0;
      border-radius: 0.5rem;
      min-height: 200px;
      background-color: white;
      transition: border-color 0.2s;
    }
    
    #qrcodeOutput.has-content {
      border: 1px solid #e2e8f0;
      border-style: solid;
    }
    
    #qrcodeOutput img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: auto;
      border-radius: 0.375rem;
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
    
    .tab-button {
      padding: 0.5rem 1rem;
      border-bottom: 2px solid transparent;
      color: #6b7280;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .tab-button:hover {
      color: #374151;
      border-color: #d1d5db;
    }
    
    .tab-button.active {
      color: #4ADE80;
      border-color: #4ADE80;
    }
    
    .tab-content {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .color-preset {
      width: 40px;
      height: 40px;
      border: 2px solid #e5e7eb;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    
    .color-preset:hover {
      border-color: #4ADE80;
    }
    
    .color-preset.active {
      border-color: #4ADE80;
      box-shadow: 0 0 0 2px rgba(74, 222, 128, 0.2);
    }
    
    .loading {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-N9X3N0RY0H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N9X3N0RY0H');
  </script>
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1835873052239386" crossorigin="anonymous"></script>
</head>

<body class="bg-gray-50 text-gray-800 font-inter min-h-screen flex flex-col">
  
  <!-- Header（統一デザイン） -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-4">
      <a href="/" class="text-2xl font-extrabold text-accent tracking-tight hover:opacity-80 transition">negi-lab.com</a>
      <nav>
        <ul class="flex gap-6 font-medium text-base items-center">
          <li><a href="/#tools" class="hover:text-accent transition" data-translate-key="header.nav.tools">ツール</a></li>
          <li><a href="/#wikis" class="hover:text-accent transition" data-translate-key="header.nav.wikis">ゲームWiki</a></li>
          <li>
            <select id="lang-switch" class="rounded border border-gray-300 px-2 py-1 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-accent transition">
              <option value="ja" data-translate-key="option.ja">日本語</option>
              <option value="en" data-translate-key="option.en">English</option>
            </select>
          </li>
          <li>
            <button id="guide-btn" class="rounded border border-accent px-3 py-1 text-accent text-sm font-semibold bg-white hover:bg-accent/10 focus:outline-none focus:ring-2 focus:ring-accent transition" aria-haspopup="dialog" aria-controls="guide-modal" data-translate-key="header.guide">ガイド</button>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-grow bg-white py-12">
    <div class="max-w-3xl mx-auto px-4">
      
      <!-- Title Section -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4" data-translate-key="qrGenerator.title">
          QRコード作成ツール
        </h1>
        <p class="text-lg text-gray-600" data-translate-key="qrGenerator.description">
          テキストやURLからカスタムQRコードを簡単に生成
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Input Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          
          <!-- Tabs -->
          <div class="flex border-b border-gray-200 mb-6">
            <button class="tab-button active" 
                    data-tab="single" 
                    data-translate-key="qrGenerator.tabs.single">
              単体生成
            </button>
            <button class="tab-button" 
                    data-tab="batch" 
                    data-translate-key="qrGenerator.tabs.batch">
              一括生成
            </button>
            <button class="tab-button" 
                    data-tab="design" 
                    data-translate-key="qrGenerator.tabs.design">
              デザイン
            </button>
          </div>

          <!-- Single Generation Tab -->
          <div id="single-tab" class="tab-content">
            <div class="space-y-4">
              <div>
                <label for="qrText" 
                       class="block text-sm font-medium text-gray-700 mb-2" 
                       data-translate-key="qrGenerator.form.text">
                  テキスト/URL
                </label>
                <textarea id="qrText"
                          class="form-input w-full h-24 resize-vertical"
                          placeholder="https://example.com またはテキストを入力"
                          data-translate-key="qrGenerator.form.textPlaceholder"></textarea>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label for="qrSize" 
                         class="block text-sm font-medium text-gray-700 mb-2" 
                         data-translate-key="qrGenerator.form.size">
                    サイズ (px)
                  </label>
                  <input type="number"
                         id="qrSize"
                         class="form-input w-full"
                         value="256"
                         min="128"
                         max="1024"
                         step="32" />
                </div>
                
                <div>
                  <label for="errorCorrection" 
                         class="block text-sm font-medium text-gray-700 mb-2" 
                         data-translate-key="qrGenerator.form.errorCorrection">
                    エラー訂正
                  </label>
                  <select id="errorCorrection" class="form-select w-full">
                    <option value="L" data-translate-key="qrGenerator.errorCorrection.low">低 (L)</option>
                    <option value="M" selected data-translate-key="qrGenerator.errorCorrection.medium">中 (M)</option>
                    <option value="Q" data-translate-key="qrGenerator.errorCorrection.quartile">高 (Q)</option>
                    <option value="H" data-translate-key="qrGenerator.errorCorrection.high">最高 (H)</option>
                  </select>
                </div>
              </div>
              
              <button id="generateBtn"
                      class="form-button w-full py-3 text-lg font-semibold"
                      data-translate-key="qrGenerator.form.generate">
                QRコード生成
              </button>
            </div>
          </div>

          <!-- Batch Generation Tab -->
          <div id="batch-tab" class="tab-content hidden">
            <div class="space-y-4">
              <div>
                <label for="batchText" 
                       class="block text-sm font-medium text-gray-700 mb-2" 
                       data-translate-key="qrGenerator.batch.label">
                  テキスト（1行ごと）
                </label>
                <textarea id="batchText"
                          class="form-input w-full h-32 resize-vertical"
                          placeholder="URL1&#10;URL2&#10;URL3..."
                          data-translate-key="qrGenerator.batch.placeholder"></textarea>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label for="batchSize" 
                         class="block text-sm font-medium text-gray-700 mb-2" 
                         data-translate-key="qrGenerator.form.size">
                    サイズ (px)
                  </label>
                  <input type="number"
                         id="batchSize"
                         class="form-input w-full"
                         value="256"
                         min="128"
                         max="512"
                         step="32" />
                </div>
                
                <div>
                  <label for="batchErrorCorrection" 
                         class="block text-sm font-medium text-gray-700 mb-2" 
                         data-translate-key="qrGenerator.form.errorCorrection">
                    エラー訂正
                  </label>
                  <select id="batchErrorCorrection" class="form-select w-full">
                    <option value="L" data-translate-key="qrGenerator.errorCorrection.low">低 (L)</option>
                    <option value="M" selected data-translate-key="qrGenerator.errorCorrection.medium">中 (M)</option>
                    <option value="Q" data-translate-key="qrGenerator.errorCorrection.quartile">高 (Q)</option>
                    <option value="H" data-translate-key="qrGenerator.errorCorrection.high">最高 (H)</option>
                  </select>
                </div>
              </div>
              
              <button id="batchGenerateBtn"
                      class="form-button w-full py-3 text-lg font-semibold"
                      data-translate-key="qrGenerator.batch.generate">
                一括生成・ダウンロード
              </button>
            </div>
          </div>

          <!-- Design Tab -->
          <div id="design-tab" class="tab-content hidden">
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label for="foregroundColor" 
                         class="block text-sm font-medium text-gray-700 mb-2" 
                         data-translate-key="qrGenerator.design.foreground">
                    前景色
                  </label>
                  <div class="flex gap-2 items-center">
                    <input type="color"
                           id="foregroundColor"
                           class="w-12 h-10 border border-gray-300 rounded cursor-pointer"
                           value="#000000" />
                    <input type="text"
                           id="foregroundColorText"
                           class="form-input flex-1"
                           value="#000000"
                           placeholder="#000000" />
                  </div>
                </div>
                
                <div>
                  <label for="backgroundColor" 
                         class="block text-sm font-medium text-gray-700 mb-2" 
                         data-translate-key="qrGenerator.design.background">
                    背景色
                  </label>
                  <div class="flex gap-2 items-center">
                    <input type="color"
                           id="backgroundColor"
                           class="w-12 h-10 border border-gray-300 rounded cursor-pointer"
                           value="#ffffff" />
                    <input type="text"
                           id="backgroundColorText"
                           class="form-input flex-1"
                           value="#ffffff"
                           placeholder="#ffffff" />
                  </div>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" 
                       data-translate-key="qrGenerator.design.presets">
                  プリセット
                </label>
                <div class="flex gap-2 flex-wrap">
                  <div class="color-preset active" 
                       data-fg="#000000" 
                       data-bg="#ffffff" 
                       style="background: linear-gradient(45deg, #000000 50%, #ffffff 50%);"></div>
                  <div class="color-preset" 
                       data-fg="#ffffff" 
                       data-bg="#000000" 
                       style="background: linear-gradient(45deg, #ffffff 50%, #000000 50%);"></div>
                  <div class="color-preset" 
                       data-fg="#1f2937" 
                       data-bg="#f3f4f6" 
                       style="background: linear-gradient(45deg, #1f2937 50%, #f3f4f6 50%);"></div>
                  <div class="color-preset" 
                       data-fg="#dc2626" 
                       data-bg="#fee2e2" 
                       style="background: linear-gradient(45deg, #dc2626 50%, #fee2e2 50%);"></div>
                  <div class="color-preset" 
                       data-fg="#059669" 
                       data-bg="#d1fae5" 
                       style="background: linear-gradient(45deg, #059669 50%, #d1fae5 50%);"></div>
                  <div class="color-preset" 
                       data-fg="#2563eb" 
                       data-bg="#dbeafe" 
                       style="background: linear-gradient(45deg, #2563eb 50%, #dbeafe 50%);"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Output Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4" 
              data-translate-key="qrGenerator.output.title">
            生成結果
          </h2>
          
          <div id="qrcodeOutput">
            <div class="text-center text-gray-500">
              <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                <path d="M3 3h8v8H3V3zm2 2v4h4V5H5zm8-2h8v8h-8V3zm2 2v4h4V5h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm10 0h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm-6-6h2v2h-2v-2zm2-2h2v2h-2v-2z"/>
              </svg>
              <p data-translate-key="qrGenerator.output.placeholder">
                QRコードがここに表示されます
              </p>
            </div>
          </div>
          
          <div id="downloadSection" class="mt-4 hidden">
            <button id="downloadBtn"
                    class="form-button w-full py-2"
                    data-translate-key="qrGenerator.output.download">
              画像をダウンロード
            </button>
          </div>
          
          <div id="batchDownloadSection" class="mt-4 hidden">
            <div class="space-y-2">
              <div class="text-sm text-gray-600">
                <span id="batchProgress">0 / 0</span> 件処理中...
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="batchProgressBar" 
                     class="bg-accent h-2 rounded-full transition-all duration-300" 
                     style="width: 0%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 独自性・免責事項セクション（全ツール統一） -->
  <section class="mt-12 mb-8 text-sm text-gray-700 bg-white rounded-lg p-4 border border-gray-200 max-w-xl mx-auto">
    <h2 class="text-lg font-bold mb-2">独自性・運営方針・免責事項</h2>
    <ul class="list-disc ml-5 mb-2">
      <li>本サイトは個人が独自に企画・開発・運営しています。</li>
      <li>利便性・楽しさ・学びを重視し、独自の視点で情報やツールを提供します。</li>
      <li>内容の正確性・安全性には配慮しますが、利用による損害等の責任は負いかねます。</li>
    </ul>
    <p>ご意見・ご要望は <a href="mailto:negilab.com@gmail.com" class="underline text-accent">negilab.com@gmail.com</a> まで。</p>
  </section>

  <!-- Footer（統一デザイン/navリンク付き） -->
  <footer class="bg-gray-800 text-gray-300 py-8 text-center text-sm">
    <nav class="mb-2">
      <a href="/privacy-policy-unified.html" class="underline hover:text-accent mx-2">プライバシーポリシー</a>
      <a href="/terms.html" class="underline hover:text-accent mx-2">利用規約</a>
      <a href="/about.html" class="underline hover:text-accent mx-2">運営者情報</a>
      <a href="mailto:negilab.com@gmail.com" class="underline hover:text-accent mx-2">お問い合わせ</a>
      <a href="/sitemap.xml" class="underline hover:text-accent mx-2">サイトマップ</a>
    </nav>
    <div>&copy; 2025 negi-lab.com</div>
  </footer>

  <!-- Guide Modal Popup（body直下配置でz-index競合回避） -->
  <div id="guide-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden" role="dialog" aria-modal="true" aria-labelledby="guide-modal-title">
    <div class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 relative">
      <button id="guide-close" class="absolute top-2 right-2 text-gray-400 hover:text-accent text-2xl font-bold" aria-label="閉じる">&times;</button>
      <div id="guide-modal-content">
        <div class="space-y-4 text-gray-700">
          <section>
            <h3 class="font-semibold text-lg mb-2" data-translate-key="guide.basic.title">基本的な使い方</h3>
            <ul class="list-disc list-inside space-y-1 text-sm">
              <li data-translate-key="guide.basic.step1">テキストまたはURLを入力欄に入力</li>
              <li data-translate-key="guide.basic.step2">サイズとエラー訂正レベルを選択</li>
              <li data-translate-key="guide.basic.step3">「QRコード生成」ボタンをクリック</li>
              <li data-translate-key="guide.basic.step4">生成されたQRコードを右クリックで保存</li>
            </ul>
          </section>
          <section>
            <h3 class="font-semibold text-lg mb-2" data-translate-key="guide.features.title">機能説明</h3>
            <ul class="list-disc list-inside space-y-1 text-sm">
              <li data-translate-key="guide.features.single">単体生成: 1つのQRコードを生成</li>
              <li data-translate-key="guide.features.batch">一括生成: 複数のQRコードを一度に生成</li>
              <li data-translate-key="guide.features.design">デザイン: 色をカスタマイズ</li>
              <li data-translate-key="guide.features.download">ダウンロード: PNG形式で保存</li>
            </ul>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- QRコード生成ライブラリ（改良版） -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"
          onload="console.log('✅ Qrious読み込み完了')"
          onerror="console.warn('⚠️ Qrious読み込みエラー - フォールバックを使用')"></script>
  <script>
    // タブ切り替え
    function switchTab(tab) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
      document.getElementById(`${tab}-tab`).classList.remove('hidden');
    }
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', e => switchTab(e.target.dataset.tab));
    });

    // カラープリセット
    function applyColorPreset(fg, bg, target) {
      document.getElementById('foregroundColor').value = fg;
      document.getElementById('foregroundColorText').value = fg;
      document.getElementById('backgroundColor').value = bg;
      document.getElementById('backgroundColorText').value = bg;
      document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('active'));
      if(target) target.classList.add('active');
    }
    document.querySelectorAll('.color-preset').forEach(preset => {
      preset.addEventListener('click', e => {
        applyColorPreset(e.target.dataset.fg, e.target.dataset.bg, e.target);
      });
    });

    document.getElementById('foregroundColor').addEventListener('input', e => {
      document.getElementById('foregroundColorText').value = e.target.value;
    });
    document.getElementById('foregroundColorText').addEventListener('input', e => {
      if(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(e.target.value))
        document.getElementById('foregroundColor').value = e.target.value;
    });
    document.getElementById('backgroundColor').addEventListener('input', e => {
      document.getElementById('backgroundColorText').value = e.target.value;
    });
    document.getElementById('backgroundColorText').addEventListener('input', e => {
      if(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(e.target.value))
        document.getElementById('backgroundColor').value = e.target.value;
    });

    // ガイドモーダル
    const guideModal = document.getElementById('guide-modal');
    document.getElementById('guide-btn').addEventListener('click', () => {
      guideModal.classList.remove('hidden');
    });
    document.getElementById('guide-close').addEventListener('click', () => {
      guideModal.classList.add('hidden');
    });
    guideModal.addEventListener('click', e => {
      if(e.target === guideModal) guideModal.classList.add('hidden');
    });

    // QRコード生成
    function getOptions(single) {
      return {
        size: parseInt(document.getElementById(single ? 'qrSize' : 'batchSize').value),
        errorCorrection: document.getElementById(single ? 'errorCorrection' : 'batchErrorCorrection').value,
        foreground: document.getElementById('foregroundColorText').value,
        background: document.getElementById('backgroundColorText').value
      };
    }
    function generateQR(text, options) {
      return new Promise((resolve, reject) => {
        if(typeof QRious !== 'undefined') {
          try {
            const qr = new QRious({
              value: text,
              size: options.size,
              level: options.errorCorrection,
              background: options.background,
              foreground: options.foreground
            });
            const img = new window.Image();
            img.src = qr.toDataURL();
            img.onload = () => resolve(img);
            img.onerror = () => reject(new Error('QR生成失敗'));
          } catch(e) { reject(e); }
        } else {
          reject(new Error('QRiousライブラリが読み込まれていません'));
        }
      });
    }
    function setLoading(btn, loading, text) {
      if(loading) {
        btn.disabled = true;
        btn.innerHTML = '<svg class="loading w-5 h-5 mr-2 inline" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2v4m0 12v4m8-10h-4M6 12H2m15.364-6.364l-2.828 2.828M8.464 17.536l-2.828 2.828m11.314 0l-2.828-2.828M8.464 6.464L5.636 9.292"/></svg>' + text;
      } else {
        btn.disabled = false;
        btn.textContent = text;
      }
    }
    document.getElementById('generateBtn').addEventListener('click', async () => {
      const text = document.getElementById('qrText').value.trim();
      if(!text) return alert('テキストまたはURLを入力してください。');
      const btn = document.getElementById('generateBtn');
      setLoading(btn, true, '生成中...');
      try {
        const options = getOptions(true);
        const img = await generateQR(text, options);
        const output = document.getElementById('qrcodeOutput');
        output.innerHTML = '';
        output.appendChild(img);
        output.classList.add('has-content');
        document.getElementById('downloadSection').classList.remove('hidden');
        window._qrImage = img;
      } catch(e) {
        alert('QRコード生成に失敗しました: ' + e.message);
      } finally {
        setLoading(btn, false, 'QRコード生成');
      }
    });
    document.getElementById('downloadBtn').addEventListener('click', () => {
      if(!window._qrImage) return;
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = window._qrImage;
      canvas.width = img.naturalWidth || img.width;
      canvas.height = img.naturalHeight || img.height;
      ctx.drawImage(img, 0, 0);
      canvas.toBlob(blob => {
        const ts = new Date().toISOString().replace(/[-:T.]/g, '').slice(0,14);
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `qrcode_${ts}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);
      }, 'image/png');
    });
    // 一括生成（簡易: 画像を連続生成してダウンロードはjson）
    document.getElementById('batchGenerateBtn').addEventListener('click', async () => {
      const batchText = document.getElementById('batchText').value.trim();
      if(!batchText) return alert('テキストを入力してください（1行ごと）');
      const lines = batchText.split('\n').filter(l => l.trim());
      if(lines.length === 0) return alert('有効なテキストが見つかりません。');
      if(lines.length > 50 && !confirm('50件を超えるQRコードを生成しようとしています。続行しますか？')) return;
      const btn = document.getElementById('batchGenerateBtn');
      setLoading(btn, true, '生成中...');
      document.getElementById('batchDownloadSection').classList.remove('hidden');
      const options = getOptions(false);
      const zipData = [];
      for(let i=0;i<lines.length;i++) {
        document.getElementById('batchProgress').textContent = `${i+1} / ${lines.length}`;
        document.getElementById('batchProgressBar').style.width = `${((i+1)/lines.length)*100}%`;
        try {
          const img = await generateQR(lines[i], options);
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = options.size;
          canvas.height = options.size;
          ctx.drawImage(img, 0, 0);
          zipData.push({name: `qr_${i+1}.png`, data: canvas.toDataURL('image/png')});
        } catch(e) {}
      }
      // jsonでダウンロード
      const blob = new Blob([JSON.stringify(zipData, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `qr_batch_${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
      setTimeout(()=>{
        document.getElementById('batchDownloadSection').classList.add('hidden');
      }, 2000);
      setLoading(btn, false, '一括生成・ダウンロード');
    });
  </script>
</body>
</html>