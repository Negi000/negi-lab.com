<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self'; 
    script-src 'self' 'unsafe-inline' 'unsafe-eval' 
      https://cdn.tailwindcss.com 
      https://pagead2.googlesyndication.com 
      https://www.googletagmanager.com
      https://googleads.g.doubleclick.net
      https://ep1.adtrafficquality.google; 
    style-src 'self' 'unsafe-inline' 
      https://fonts.googleapis.com 
      https://cdn.tailwindcss.com; 
    font-src 'self' 
      https://fonts.gstatic.com; 
    img-src 'self' data: blob:; 
    connect-src 'self' 
      https://www.google-analytics.com
      https://ep1.adtrafficquality.google; 
    frame-src 'self'
      https://googleads.g.doubleclick.net; 
    object-src 'none'; 
    base-uri 'self';
  " />

  <!-- Guide Modal Popup -->
  <div id="guide-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden" role="dialog" aria-modal="true" aria-labelledby="guide-modal-title">
    <div class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 relative">
      <button id="guide-close" class="absolute top-2 right-2 text-gray-400 hover:text-accent text-2xl font-bold" aria-label="閉じる">&times;</button>
      <div id="guide-modal-content"></div>
    </div>
  </div>
  
  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <title data-translate-key="dateCalculator.pageTitle">【無料】日付計算ツール - 期間計算・日数計算・年齢計算 | negi-lab.com</title>
  <meta name="description" data-translate-key="dateCalculator.metaDescription" content="高精度な日付・期間計算と年齢・勤続年数・記念日管理に対応した専門計算ツール。営業日計算・プロジェクト管理・人事業務での期間計算を効率化する実用的な日付計算ソリューションです。" />
  <meta property="og:title" content="【無料】日付計算ツール - 期間計算・日数計算・年齢計算 | negi-lab.com" />
  <meta property="og:description" content="2つの日付の期間・日数計算や、日付の加減算が簡単にできる無料ツール。年齢計算、勤続年数、記念日までの日数計算にも対応。" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://negi-lab.com/tools/date-calculator.html" />
  <meta name="robots" content="index,follow" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" crossorigin="anonymous" />
  <!-- 開発環境用Tailwind CDN - 本番環境では PostCSS プラグインまたは Tailwind CLI を使用してください -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Security and Common Utilities -->
  <script src="../js/security-utils.js" onerror="console.warn('security-utils.js読み込みエラー')"></script>
  <script src="../js/common-utils.js" onerror="console.warn('common-utils.js読み込みエラー')"></script>
  
  <!-- 翻訳システム -->
  <script src="../js/common-translations.js"></script>
  <script src="../js/date-calculator-translations.js"></script>
  <script src="../js/tool-translation-system.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            negi: "#65c155",
            accent: "#4ADE80"
          },
          fontFamily: { inter: ["Inter", "sans-serif"] }
        }
      }
    }
    window.pageTitleTranslationKey = "dateCalculator.pageTitle";
    window.metaDescriptionTranslationKey = "dateCalculator.metaDescription";
  </script>
  <style>
    .form-input, .form-button {
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      transition: box-shadow 0.2s;
    }
    .form-input:focus, .form-button:focus {
      outline: none;
      box-shadow: 0 0 0 2px #4ADE80;
      border-color: #4ADE80;
    }
    .form-button {
      background: #4ADE80;
      color: #fff;
      transition: background 0.15s, color 0.15s;
    }
    .form-button:hover:not(:disabled) {
      background: #10b981;
    }
    .form-button:disabled {
      background: #d1d5db;
      color: #fff;
      cursor: not-allowed;
    }
  </style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1835873052239386" crossorigin="anonymous"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-inter min-h-screen flex flex-col">
  <!-- Amazonアソシエイト/楽天アフィリエイト Cookie埋め込み・imgタグ削除（ASP規約対策） -->
  <!-- Google Analytics（gtag.js）全ページ用 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-N9X3N0RY0H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N9X3N0RY0H');
  </script>
  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-4">
      <a href="/" class="text-2xl font-extrabold text-accent tracking-tight hover:opacity-80 transition">negi-lab.com</a>
      <nav>
        <ul class="flex gap-6 font-medium text-base items-center">
          <li><a href="/#tools" class="hover:text-accent transition" data-translate-key="header.nav.tools">ツール</a></li>
          <li><a href="/#wikis" class="hover:text-accent transition" data-translate-key="header.nav.wikis">ゲームWiki</a></li>
          <li>
            <select id="lang-switch" class="rounded border border-gray-300 px-2 py-1 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-accent transition">
              <option value="ja" data-translate-key="option.ja">日本語</option>
              <option value="en" data-translate-key="option.en">English</option>
            </select>
          </li>
          <li>
            <button id="guide-btn" class="rounded border border-accent px-3 py-1 text-accent text-sm font-semibold bg-white hover:bg-accent/10 focus:outline-none focus:ring-2 focus:ring-accent transition" aria-haspopup="dialog" aria-controls="guide-modal" data-translate-key="header.guide">ガイド</button>
          </li>
        </ul>
      </nav>
    </div>
  </header>
  
  <!-- ブレッドクラムナビゲーション -->
  <nav class="bg-gray-100 border-b border-gray-200" aria-label="ページナビゲーション">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <ol class="flex items-center space-x-2 text-sm text-gray-600">
        <li><a href="/" class="text-accent hover:underline">ホーム</a></li>
        <li><span class="text-gray-400">/</span></li>
        <li><a href="/#tools" class="text-accent hover:underline">ツール</a></li>
        <li><span class="text-gray-400">/</span></li>
        <li class="text-gray-800 font-medium" aria-current="page">日付計算ツール</li>
      </ol>
    </div>
  </nav>
  
  <main class="flex-grow py-12">
    <div class="container mx-auto px-4 max-w-6xl">
      <div class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4" data-translate-key="dateCalculator.mainTitle">日付計算ツール</h1>
      </div>
      <!-- ツール上部：アドセンス（レスポンシブ） -->
      <div class="max-w-2xl mx-auto my-6">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1835873052239386"
             data-ad-slot="2847561903"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
      <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg space-y-8">
        <div class="mb-6 flex gap-4">
          <button id="tabDiff" class="tab-btn px-4 py-2 rounded font-semibold bg-accent text-white">日付の差分</button>
          <button id="tabAddSub" class="tab-btn px-4 py-2 rounded font-semibold bg-gray-200 text-gray-700">日付の加減算</button>
        </div>
        <!-- 共通オプション -->
        <form id="commonOptions" class="mb-6 flex flex-wrap gap-6 items-center">
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" id="optionIncludeStart" class="form-checkbox" checked> 最初の日を含める
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" id="optionIncludeEnd" class="form-checkbox" checked> 最後の日を含める
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" id="optionBiz" class="form-checkbox" checked> 営業日数で計算（祝日・土日除外）
          </label>
        </form>
        <div id="diffSection">
          <h2 class="text-xl font-semibold mb-4" data-translate-key="dateCalculator.diffTitle">2つの日付の差を計算</h2>
          <form id="diffForm" class="space-y-4">
            <div>
              <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="dateCalculator.start">開始日</label>
              <input type="date" id="startDate" class="form-input w-full" required />
            </div>
            <div>
              <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="dateCalculator.end">終了日</label>
              <input type="date" id="endDate" class="form-input w-full" required />
            </div>
            <button type="submit" class="form-button w-full" data-translate-key="dateCalculator.calcDiff">日数を計算</button>
          </form>
          <div id="diffResult" class="bg-gray-50 rounded-lg p-4 mt-4 text-lg text-center text-accent font-bold hidden"></div>
        </div>
        <div id="addsubSection" style="display:none;">
          <h2 class="text-xl font-semibold mb-4" data-translate-key="dateCalculator.addsubTitle">日付の加算・減算</h2>
          <form id="addsubForm" class="space-y-4">
            <div>
              <label for="baseDate" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="dateCalculator.base">基準日</label>
              <input type="date" id="baseDate" class="form-input w-full" required />
            </div>
            <div>
              <label for="days" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="dateCalculator.days">日数（±）</label>
              <input type="number" id="days" class="form-input w-full" required placeholder="例: 10 または -5" />
            </div>
            <button type="submit" class="form-button w-full" data-translate-key="dateCalculator.calcAddSub">日付を計算</button>
          </form>
          <div id="addsubResult" class="bg-gray-50 rounded-lg p-4 mt-4 text-lg text-center text-accent font-bold hidden"></div>
        </div>
        <!-- 日付トリビア表示 -->
        <div>
          <h2 class="text-xl font-semibold mb-4">日付トリビア</h2>
          <div id="dateTrivia" class="bg-emerald-50 rounded-lg p-4 text-gray-700 text-sm"></div>
        </div>
      </div>
      <!-- スポンサーリンクラベル（広告直前） -->
      <div class="text-xs text-gray-500 mb-1 mt-8" aria-label="スポンサーリンク">スポンサーリンク</div>
      <!-- ここに広告コード（例: AdSense）を挿入 -->
      <!-- ツール下部：Amazon・楽天バナー → ネイティブ/モーションウィジェット動的表示に置換 -->
      <div id="smart-ads" class="flex justify-center my-8"></div>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          if (window.renderSmartAds) window.renderSmartAds('smart-ads');
        });
      </script>
      <!-- フッター直前：アドセンス（インフィード/ディスプレイ） -->
      <div class="max-w-xl mx-auto my-8">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1835873052239386"
             data-ad-slot="8374251609"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    </div>
  </main>

  <!-- 活用事例・ユースケースセクション -->
  <section class="bg-gradient-to-br from-blue-50 to-indigo-100 py-16">
    <div class="container mx-auto px-4 max-w-6xl">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">日付計算ツールの実用的な活用事例</h2>
        <p class="text-gray-600 text-lg max-w-3xl mx-auto">
          プロジェクト管理・契約業務・人事労務での具体的な活用シーンと、その効果をご紹介します。
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- プロジェクト管理・スケジューリング -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
          <div class="flex items-center mb-4">
            <div class="bg-blue-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-800">プロジェクト管理・スケジューリング</h3>
          </div>
          <ul class="space-y-3 text-gray-600">
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>納期逆算：</strong>完成日から開始日を逆算・作業期間最適化</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>工数見積もり：</strong>営業日ベースでの正確な作業日数計算</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>マイルストーン設定：</strong>中間締切・レビュー日程の自動算出</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>休日考慮：</strong>祝日・年末年始を除いた実稼働日計算</span>
            </li>
          </ul>
        </div>

        <!-- 契約・法務・経理 -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
          <div class="flex items-center mb-4">
            <div class="bg-green-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-800">契約・法務・経理</h3>
          </div>
          <ul class="space-y-3 text-gray-600">
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>契約期間管理：</strong>契約満了日・更新タイミングの自動計算</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>支払期限管理：</strong>請求日から支払期限・延滞判定日の算出</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>法定期間計算：</strong>クーリングオフ期間・時効期間の確認</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>決算期管理：</strong>四半期・年次決算期間の自動算出</span>
            </li>
          </ul>
        </div>

        <!-- 人事・労務・給与 -->
        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
          <div class="flex items-center mb-4">
            <div class="bg-purple-100 p-3 rounded-lg mr-4">
              <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-800">人事・労務・給与</h3>
          </div>
          <ul class="space-y-3 text-gray-600">
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>勤続年数計算：</strong>入社日からの正確な勤続期間・昇格タイミング</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>有給休暇管理：</strong>入社日起算の有給付与日・日数計算</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>試用期間管理：</strong>試用期間満了日・本採用切り替え日程</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-500 mr-2">✓</span>
              <span><strong>退職手続き：</strong>退職日から各種手続き完了期限の算出</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- 技術解説セクション -->
  <section class="bg-white py-16">
    <div class="container mx-auto px-4 max-w-6xl">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">日付計算技術の詳細解説</h2>
        <p class="text-gray-600 text-lg max-w-3xl mx-auto">
          暦法・タイムゾーン・うるう年などの複雑な日付処理のロジックを理解しましょう。
        </p>
      </div>

      <div class="grid md:grid-cols-2 gap-12">
        <div>
          <h3 class="text-2xl font-semibold mb-6 text-gray-800">日付計算の技術的複雑性</h3>
          <div class="space-y-4">
            <div class="border-l-4 border-blue-400 pl-4 py-2">
              <h4 class="font-medium text-lg">うるう年の計算規則</h4>
              <p class="text-sm text-gray-600 mb-2">4年に1度＋100年に1度なし＋400年に1度あり。精密な日数計算に不可欠。</p>
              <div class="text-xs bg-blue-50 p-2 rounded">
                <strong>例：</strong>2000年（うるう年）、1900年（平年）、2024年（うるう年）
              </div>
            </div>
            <div class="border-l-4 border-green-400 pl-4 py-2">
              <h4 class="font-medium text-lg">営業日・祝日の複雑性</h4>
              <p class="text-sm text-gray-600 mb-2">国民の祝日・振替休日・年末年始の変動パターンを動的に処理。</p>
              <div class="text-xs bg-green-50 p-2 rounded">
                <strong>対応：</strong>ハッピーマンデー・春分の日・秋分の日・天皇誕生日変更
              </div>
            </div>
            <div class="border-l-4 border-purple-400 pl-4 py-2">
              <h4 class="font-medium text-lg">タイムゾーン・夏時間</h4>
              <p class="text-sm text-gray-600 mb-2">世界各国の時差・夏時間（DST）の開始終了日を考慮した計算。</p>
              <div class="text-xs bg-purple-50 p-2 rounded">
                <strong>注意：</strong>国際プロジェクトでは現地時間基準の日付計算が必須
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <h3 class="text-2xl font-semibold mb-6 text-gray-800">実務での計算精度向上</h3>
          <div class="space-y-6">
            <div>
              <h4 class="font-medium mb-2 text-lg">営業日計算の実装パターン</h4>
              <div class="space-y-2">
                <div class="flex justify-between items-center p-2 bg-red-50 rounded">
                  <span class="font-medium">基本営業日</span>
                  <span class="text-sm text-gray-600">月〜金（土日除外）</span>
                </div>
                <div class="flex justify-between items-center p-2 bg-yellow-50 rounded">
                  <span class="font-medium">祝日考慮</span>
                  <span class="text-sm text-gray-600">国民の祝日・振替休日除外</span>
                </div>
                <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                  <span class="font-medium">企業独自</span>
                  <span class="text-sm text-gray-600">夏季・年末年始休暇追加</span>
                </div>
              </div>
            </div>
            
            <div>
              <h4 class="font-medium mb-2 text-lg">期間計算の注意点</h4>
              <ul class="text-sm text-gray-600 space-y-1">
                <li>• <strong>開始日・終了日の扱い：</strong>期間に含むか否かの明確化</li>
                <li>• <strong>月末日の処理：</strong>31日→2月28日等の月末調整</li>
                <li>• <strong>時刻の考慮：</strong>日付のみか時刻まで含むかの設定</li>
                <li>• <strong>小数点以下：</strong>端数処理（切り上げ・切り捨て・四捨五入）</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ・トラブルシューティングセクション -->
  <section class="bg-gray-50 py-16">
    <div class="container mx-auto px-4 max-w-6xl">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">よくある質問・トラブルシューティング</h2>
        <p class="text-gray-600 text-lg max-w-3xl mx-auto">
          日付計算時によくある疑問や問題の解決方法をまとめました。
        </p>
      </div>

      <div class="space-y-6">
        <details class="bg-white border border-gray-200 rounded-lg p-6 cursor-pointer hover:bg-gray-50">
          <summary class="font-semibold text-lg text-gray-800 flex items-center justify-between">
            <span>営業日計算で休日が正しく反映されない</span>
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </summary>
          <div class="mt-4 space-y-4">
            <p class="text-gray-700 mb-3"><strong>休日データの更新と確認：</strong></p>
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <h4 class="font-medium text-blue-600 mb-2">国民の祝日の変動要因</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                  <li>• <strong>天皇誕生日：</strong>2019年に12/23→2/23に変更</li>
                  <li>• <strong>振替休日：</strong>土曜祝日の月曜振替処理</li>
                  <li>• <strong>ハッピーマンデー：</strong>成人の日・海の日・敬老の日等</li>
                  <li>• <strong>春分・秋分の日：</strong>年によって20日・21日・22日・23日に変動</li>
                </ul>
              </div>
              <div>
                <h4 class="font-medium text-green-600 mb-2">確認・対処方法</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                  <li>• <strong>内閣府カレンダー：</strong>公式の祝日情報を定期確認</li>
                  <li>• <strong>企業独自休日：</strong>年末年始・夏季休暇の反映</li>
                  <li>• <strong>業界特有の休日：</strong>銀行休業日・証券取引所休場日</li>
                  <li>• <strong>地域特有の休日：</strong>地方自治体の独自休日</li>
                </ul>
              </div>
            </div>
          </div>
        </details>
        
        <details class="bg-white border border-gray-200 rounded-lg p-6 cursor-pointer hover:bg-gray-50">
          <summary class="font-semibold text-lg text-gray-800 flex items-center justify-between">
            <span>年齢計算・勤続年数で1日ずれる</span>
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </summary>
          <div class="mt-4 space-y-4">
            <p class="text-gray-700 mb-3"><strong>日付の境界・基準日の扱い：</strong></p>
            <div class="space-y-4">
              <div class="bg-amber-50 p-4 rounded-lg">
                <h4 class="font-medium mb-2">年齢計算の正確な方法</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                  <li>• <strong>満年齢基準：</strong>誕生日当日から次の年齢（民法143条）</li>
                  <li>• <strong>午前0時基準：</strong>誕生日の午前0時に年齢加算</li>
                  <li>• <strong>例：</strong>2000/4/1生まれは2024/4/1午前0時に24歳</li>
                  <li>• <strong>システム上の注意：</strong>時刻までの比較で誤差回避</li>
                </ul>
              </div>
              <div class="bg-blue-50 p-4 rounded-lg">
                <h4 class="font-medium mb-2">期間計算の起算日</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                  <li>• <strong>勤続年数：</strong>入社日を含むか否かの社内規定確認</li>
                  <li>• <strong>契約期間：</strong>開始日・終了日の解釈統一</li>
                  <li>• <strong>有給休暇：</strong>入社日から6ヶ月後の同日付与</li>
                  <li>• <strong>試用期間：</strong>入社日から3ヶ月・6ヶ月の満了日計算</li>
                </ul>
              </div>
            </div>
          </div>
        </details>

        <details class="bg-white border border-gray-200 rounded-lg p-6 cursor-pointer hover:bg-gray-50">
          <summary class="font-semibold text-lg text-gray-800 flex items-center justify-between">
            <span>プロジェクト期間の見積もりが曖昧になる</span>
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </summary>
          <div class="mt-4 space-y-4">
            <p class="text-gray-700 mb-3"><strong>実用的な期間見積もり手法：</strong></p>
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <h4 class="font-medium text-purple-600 mb-2">見積もり精度向上のコツ</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                  <li>• <strong>バッファ期間：</strong>計算期間の10-20%を予備期間に設定</li>
                  <li>• <strong>段階的マイルストーン：</strong>月次・週次での進捗確認点</li>
                  <li>• <strong>リスク要因の明確化：</strong>祝日・年末年始の影響度評価</li>
                  <li>• <strong>過去データ活用：</strong>類似プロジェクトの実績ベース調整</li>
                </ul>
              </div>
              <div>
                <h4 class="font-medium text-orange-600 mb-2">計画立案のベストプラクティス</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                  <li>• <strong>逆算型計画：</strong>締切から必要期間を逆算して開始日決定</li>
                  <li>• <strong>クリティカルパス：</strong>最重要タスクの期間確保を優先</li>
                  <li>• <strong>並行作業の活用：</strong>依存関係のないタスクは同時進行</li>
                  <li>• <strong>レビュー期間確保：</strong>成果物チェック・修正期間を含める</li>
                </ul>
              </div>
            </div>
          </div>
        </details>

        <details class="bg-white border border-gray-200 rounded-lg p-6 cursor-pointer hover:bg-gray-50">
          <summary class="font-semibold text-lg text-gray-800 flex items-center justify-between">
            <span>海外展開時のタイムゾーン・現地祝日対応</span>
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </summary>
          <div class="mt-4 space-y-4">
            <p class="text-gray-700 mb-3"><strong>国際対応の実装指針：</strong></p>
            <div class="bg-green-50 p-4 rounded-lg">
              <h4 class="font-medium mb-2">多国籍プロジェクト管理</h4>
              <ul class="text-sm text-gray-600 space-y-2">
                <li>• <strong>基準時刻の統一：</strong>UTC基準での日程管理・各国で現地時刻表示</li>
                <li>• <strong>現地祝日の考慮：</strong>国別・州別の祝日カレンダー整備</li>
                <li>• <strong>夏時間対応：</strong>3月・11月の時刻変更期間での計算注意</li>
                <li>• <strong>文化的配慮：</strong>宗教的祭日・ラマダン等の考慮</li>
              </ul>
              <div class="mt-3 p-3 bg-white rounded border-l-4 border-green-400">
                <p class="text-sm text-gray-700">
                  <strong>推奨：</strong>グローバル展開時は現地法務・人事部門と連携し、
                  正確な休日情報・労働基準法の確認が不可欠です
                </p>
              </div>
            </div>
          </div>
        </details>
      </div>
    </div>
  </section>

  <!-- 実用事例集セクション -->
  <section class="bg-white py-16">
    <div class="container mx-auto px-4 max-w-6xl">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">実際の活用事例</h2>
        <p class="text-gray-600 text-lg max-w-3xl mx-auto">
          様々な業界・用途での実際の日付計算ツール活用事例をご紹介します。
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <div class="text-4xl mb-4">💼</div>
          <h3 class="text-lg font-semibold mb-3">プロジェクト管理の効率化</h3>
          <p class="text-gray-600 text-sm mb-4">
            IT企業では、プロジェクトの納期計算・マイルストーン設定を自動化し、
            スケジュール管理精度が大幅向上。遅延リスクの早期発見を実現。
          </p>
          <div class="text-xs text-blue-600 bg-blue-50 p-2 rounded mb-2">
            使用機能: 営業日計算 + 期限逆算
          </div>
          <div class="text-xs text-gray-500">
            <strong>成果：</strong> 納期遵守率25%向上 + リスク管理強化
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <div class="text-4xl mb-4">📅</div>
          <h3 class="text-lg font-semibold mb-3">人事・労務管理の自動化</h3>
          <p class="text-gray-600 text-sm mb-4">
            人事部では、有給休暇・勤続年数・退職金計算等を正確かつ迅速に処理。
            労務管理業務の効率化と法令遵守を同時に実現。
          </p>
          <div class="text-xs text-green-600 bg-green-50 p-2 rounded mb-2">
            使用機能: 勤続年数 + 有休計算
          </div>
          <div class="text-xs text-gray-500">
            <strong>成果：</strong> 労務処理時間50%短縮 + 正確性向上
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <div class="text-4xl mb-4">🏥</div>
          <h3 class="text-lg font-semibold mb-3">医療機関での年齢・期間管理</h3>
          <p class="text-gray-600 text-sm mb-4">
            病院では、患者の正確な年齢計算・検査間隔管理により、
            医療ミスを防止し、適切な診療スケジュール管理を実現。
          </p>
          <div class="text-xs text-purple-600 bg-purple-50 p-2 rounded mb-2">
            使用機能: 年齢計算 + 期間管理
          </div>
          <div class="text-xs text-gray-500">
            <strong>成果：</strong> 医療ミス削減 + 診療効率向上
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <div class="text-4xl mb-4">📈</div>
          <h3 class="text-lg font-semibold mb-3">金融・保険業での期間計算</h3>
          <p class="text-gray-600 text-sm mb-4">
            金融機関では、融資期間・保険期間・利息計算等を正確に算出し、
            顧客サービス向上とリスク管理強化を両立。
          </p>
          <div class="text-xs text-red-600 bg-red-50 p-2 rounded mb-2">
            使用機能: 営業日計算 + 期間精算
          </div>
          <div class="text-xs text-gray-500">
            <strong>成果：</strong> 計算精度向上 + 顧客満足度向上
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <div class="text-4xl mb-4">🎓</div>
          <h3 class="text-lg font-semibold mb-3">教育機関での学事管理</h3>
          <p class="text-gray-600 text-sm mb-4">
            学校では、学期・履修期間・卒業要件等の計算を自動化し、
            学生指導の質向上と事務作業効率化を実現。
          </p>
          <div class="text-xs text-indigo-600 bg-indigo-50 p-2 rounded mb-2">
            使用機能: 学期計算 + 履修期間
          </div>
          <div class="text-xs text-gray-500">
            <strong>成果：</strong> 事務効率30%向上 + 学生支援強化
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <div class="text-4xl mb-4">⚖️</div>
          <h3 class="text-lg font-semibold mb-3">法務・契約管理の精密化</h3>
          <p class="text-gray-600 text-sm mb-4">
            法律事務所では、契約期間・時効計算・法定期限管理により、
            法的リスクを最小化し、クライアント保護を強化。
          </p>
          <div class="text-xs text-teal-600 bg-teal-50 p-2 rounded mb-2">
            使用機能: 法定期限 + 時効計算
          </div>
          <div class="text-xs text-gray-500">
            <strong>成果：</strong> 法的リスク削減 + 契約管理強化
          </div>
        </div>
      </div>

      <div class="mt-12 text-center">
        <div class="bg-accent/10 rounded-xl p-6 max-w-3xl mx-auto">
          <h3 class="text-lg font-semibold text-gray-800 mb-3">あなたの業務でも日付計算を活用しませんか？</h3>
          <p class="text-gray-600 text-sm mb-4">
            これらの事例を参考に、あなたの業界・用途に合わせた日付計算活用を始めてみましょう。
            当ツールなら、すべての日付・期間計算ニーズに対応した高精度な処理を簡単に実行できます。
          </p>
          <a href="#" onclick="document.getElementById('startDate').focus(); return false;" 
             class="inline-block bg-accent hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
            今すぐ日付計算を始める
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="mt-12 mb-8 text-sm text-gray-700 bg-white rounded-lg p-4 border border-gray-200 max-w-xl mx-auto" aria-label="このツールについて">
    <h2 class="font-bold text-base mb-2">negi-lab.comの独自性・運営方針・免責事項</h2>
    <ul class="list-disc ml-5 mb-2">
      <li>本ツールはnegi-lab.comが独自開発・運営しています。</li>
      <li>広告・アフィリエイトを含みますが、ユーザー体験を最優先しています。</li>
      <li>正確性・安全性には万全を期していますが、利用は自己責任でお願いします。</li>
    </ul>
    <p class="text-xs text-gray-500">&copy; 2025 negi-lab.com</p>
  </section>

  <!-- Guide Modal Popup -->
  <div id="guide-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden" role="dialog" aria-modal="true" aria-labelledby="guide-modal-title">
    <div class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 relative">
      <button id="guide-close" class="absolute top-2 right-2 text-gray-400 hover:text-accent text-2xl font-bold" aria-label="閉じる">&times;</button>
      <div id="guide-modal-content"></div>
    </div>
  </div>

  
  <footer class="bg-gray-800 text-gray-300 py-8 text-center text-sm">
    <nav class="mb-2">
      <a href="/privacy-policy-unified.html" class="underline hover:text-accent mx-2">プライバシーポリシー</a>
      <a href="/terms.html" class="underline hover:text-accent mx-2">利用規約</a>
      <a href="/about.html" class="underline hover:text-accent mx-2">運営者情報</a>
      <a href="mailto:negilab.com@gmail.com" class="underline hover:text-accent mx-2">お問い合わせ</a>
      <a href="/sitemap.xml" class="underline hover:text-accent mx-2">サイトマップ</a>
    </nav>
    <div>&copy; 2025 negi-lab.com</div>
  </footer>
  <script type="module" src="../index.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // タブ切り替えUI
      const tabDiff = document.getElementById('tabDiff');
      const tabAddSub = document.getElementById('tabAddSub');
      const diffSection = document.getElementById('diffSection');
      const addsubSection = document.getElementById('addsubSection');
      function switchTab(mode) {
        if (mode === 'diff') {
          tabDiff.classList.add('bg-accent','text-white');
          tabDiff.classList.remove('bg-gray-200','text-gray-700');
          tabAddSub.classList.remove('bg-accent','text-white');
          tabAddSub.classList.add('bg-gray-200','text-gray-700');
          diffSection.style.display = '';
          addsubSection.style.display = 'none';
        } else {
          tabAddSub.classList.add('bg-accent','text-white');
          tabAddSub.classList.remove('bg-gray-200','text-gray-700');
          tabDiff.classList.remove('bg-accent','text-white');
          tabDiff.classList.add('bg-gray-200','text-gray-700');
          diffSection.style.display = 'none';
          addsubSection.style.display = '';
        }
      }
      tabDiff.addEventListener('click',()=>switchTab('diff'));
      tabAddSub.addEventListener('click',()=>switchTab('addsub'));
      // 初期化
      switchTab('diff');
      // 日付差分計算
      function calcDateDiff(s, e_, useBiz, incStart, incEnd) {
        let d1 = new Date(s);
        let d2 = new Date(e_);
        if (d1 > d2) [d1, d2] = [d2, d1];
        let count = 0;
        let cur = new Date(d1);
        if (useBiz) {
          while (cur <= d2) {
            const ymd = cur.toISOString().slice(0,10);
            if (isBusinessDay(ymd)) count++;
            cur.setDate(cur.getDate() + 1);
          }
        } else {
          count = Math.floor((d2 - d1) / (1000*60*60*24)) + 1;
        }
        // 最初/最後の日を含めるか
        if (!incStart && count > 0) count--;
        if (!incEnd && count > 0) count--;
        if (!incStart && !incEnd && count < 0) count = 0;
        return count;
      }      document.getElementById('diffForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        try {
          const s = SecurityUtils.sanitizeInput(document.getElementById('startDate').value);
          const e_ = SecurityUtils.sanitizeInput(document.getElementById('endDate').value);
          const useBiz = document.getElementById('optionBiz').checked;
          const incStart = document.getElementById('optionIncludeStart').checked;
          const incEnd = document.getElementById('optionIncludeEnd').checked;
          
          if(!s || !e_) {
            SecurityUtils.showUserError('開始日と終了日を入力してください');
            return;
          }
          
          // 日付形式の検証
          const startDate = new Date(s);
          const endDate = new Date(e_);
          if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
            SecurityUtils.showUserError('正しい日付形式で入力してください');
            return;
          }
          
          const days = calcDateDiff(s, e_, useBiz, incStart, incEnd);
          const res = `${days}日` + (useBiz ? '（営業日）' : '');
          const resultBox = document.getElementById('diffResult');
          resultBox.textContent = res;
          resultBox.classList.remove('hidden');
          
          SecurityUtils.showSuccessMessage('日付差の計算が完了しました');
        } catch (error) {
          SecurityUtils.showUserError('計算中にエラーが発生しました', error);
        }
      });
      // 日付加減算
      function addBusinessDays(base, days) {
        let d = new Date(base);
        let step = days >= 0 ? 1 : -1;
        let absDays = Math.abs(days);
        let count = 0;
        while (count < absDays) {
          d.setDate(d.getDate() + step);
          const ymd = d.toISOString().slice(0,10);
          if (isBusinessDay(ymd)) count++;
        }
        return d;
      }      document.getElementById('addsubForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        try {
          const base = SecurityUtils.sanitizeInput(document.getElementById('baseDate').value);
          const daysInput = SecurityUtils.sanitizeInput(document.getElementById('days').value);
          const days = parseInt(daysInput, 10);
          const useBiz = document.getElementById('optionBiz').checked;
          const incStart = document.getElementById('optionIncludeStart').checked;
          const incEnd = document.getElementById('optionIncludeEnd').checked;
          
          if(!base || isNaN(days)) {
            SecurityUtils.showUserError('基準日と日数を正しく入力してください');
            return;
          }
          
          // 日付形式の検証
          const baseDate = new Date(base);
          if (isNaN(baseDate.getTime())) {
            SecurityUtils.showUserError('正しい日付形式で入力してください');
            return;
          }
          
          // 日数の範囲制限（セキュリティ対策）
          if (Math.abs(days) > 36500) { // 100年以内
            SecurityUtils.showUserError('日数は100年以内（±36500日）で入力してください');
            return;
          }
            let resultDate;
          let n = days;
          // 最初/最後の日を含める調整
          if (!incStart && n > 0) n--;
          if (!incEnd && n > 0) n--;
          if (useBiz) {
            resultDate = addBusinessDays(base, n);
          } else {
            let d = new Date(base);
            d.setDate(d.getDate() + n);
            resultDate = d;
          }
          const y = resultDate.getFullYear();
          const m = ('0'+(resultDate.getMonth()+1)).slice(-2);
          const dd = ('0'+resultDate.getDate()).slice(-2);
          const res = `${y}-${m}-${dd}` + (useBiz ? '（営業日計算）' : '');
          const resultBox = document.getElementById('addsubResult');
          resultBox.textContent = res;
          resultBox.classList.remove('hidden');
          
          SecurityUtils.showSuccessMessage('日付計算が完了しました');
        } catch (error) {
          SecurityUtils.showUserError('計算中にエラーが発生しました', error);
        }
      });
      // ガイドモーダル
      const guideBtn = document.getElementById('guide-btn');
      const guideModal = document.getElementById('guide-modal');
      const guideClose = document.getElementById('guide-close');
      const guideContent = document.getElementById('guide-modal-content');
      function renderGuide(lang) {
        const guides = {
          ja: {
            title: '日付計算ツールの使い方',
            list: [
              '2つの日付を入力して「日数を計算」ボタンで日数差がわかります。',
              '基準日と日数（正負）を指定して「日付を計算」ボタンで加減算結果が表示されます。',
              '祝日・営業日計算には対応していません。'
            ],
            faqTitle: 'よくある質問',
            faq: [
              {q: 'Q. 英語でも使えますか？', a: 'A. 右上の言語切替で英語UIにできます。'},
              {q: 'Q. 入力データは保存されますか？', a: 'A. 保存されません。プライバシー重視です。'}
            ],
            tipsTitle: '活用例・ヒント',
            tips: [
              '旅行や出張の日数計算',
              '締切日や納期の逆算',
              '日付の加減算で未来・過去の日付を調べる'
            ]
          },
          en: {
            title: 'How to Use the Date Calculator',
            list: [
              'Enter two dates and click "Calculate Days" to get the difference.',
              'Specify a base date and days (±) to add/subtract and get the result.',
              'No support for holidays/business days.'
            ],
            faqTitle: 'FAQ',
            faq: [
              {q: 'Q. Can I use it in English?', a: 'A. Yes, switch language from the top right.'},
              {q: 'Q. Is my input data saved?', a: 'A. No, your data is never saved.'}
            ],
            tipsTitle: 'Tips & Examples',
            tips: [
              'Calculate trip or business days',
              'Back-calculate deadlines',
              'Find a future/past date by adding/subtracting days'
            ]
          }
        };
        const g = guides[lang] || guides.ja;
        let html = `<h2 class='text-xl font-bold mb-3'>${g.title}</h2>`;
        html += '<ul class="list-disc ml-5 mb-4 text-gray-700">' + g.list.map(x=>`<li>${x}</li>`).join('') + '</ul>';
        html += `<h3 class='font-bold text-base mt-6 mb-2'>${g.faqTitle}</h3><dl class='mb-4 text-gray-700'>` + g.faq.map(f=>`<dt class='font-semibold'>${f.q}</dt><dd class='mb-2'>${f.a}</dd>`).join('') + '</dl>';
        html += `<h3 class='font-bold text-base mt-6 mb-2'>${g.tipsTitle}</h3><ul class='list-disc ml-5 text-gray-700'>` + g.tips.map(x=>`<li>${x}</li>`).join('') + '</ul>';
        guideContent.innerHTML = html;
      }
      if(guideBtn && guideModal && guideClose && guideContent) {
        guideBtn.addEventListener('click', function() {
          const lang = document.documentElement.lang || localStorage.getItem('selectedLanguage') || 'ja';
          renderGuide(lang);
          guideModal.classList.remove('hidden');
        });
        guideClose.addEventListener('click', function() {
          guideModal.classList.add('hidden');
        });
        guideModal.addEventListener('click', function(e) {
          if(e.target === guideModal) guideModal.classList.add('hidden');
        });
      }
    });
    // --- 祝日・トリビアデータの外部JSON fetch＆フォールバック ---
    let holidays = [
      '2025-01-01','2025-01-13','2025-02-11','2025-02-23','2025-03-20',
      '2025-04-29','2025-05-03','2025-05-04','2025-05-05','2025-07-21',
      '2025-08-11','2025-09-15','2025-09-23','2025-10-13','2025-11-03','2025-11-23',
      '2026-01-01','2026-01-12','2026-02-11','2026-02-23','2026-03-20','2026-04-29','2026-05-03','2026-05-04','2026-05-05','2026-07-20','2026-08-11','2026-09-21','2026-09-22','2026-09-23','2026-10-12','2026-11-03','2026-11-23',
      '2027-01-01','2027-01-11','2027-02-11','2027-02-23','2027-03-21','2027-04-29','2027-05-03','2027-05-04','2027-05-05','2027-07-19','2027-08-11','2027-09-20','2027-09-23','2027-10-11','2027-11-03','2027-11-23',
      '2028-01-01','2028-01-10','2028-02-11','2028-02-23','2028-03-20','2028-04-29','2028-05-03','2028-05-04','2028-05-05','2028-07-17','2028-08-11','2028-09-18','2028-09-20','2028-10-09','2028-11-03','2028-11-23',
      '2029-01-01','2029-01-08','2029-02-11','2029-02-23','2029-03-20','2029-04-29','2029-05-03','2029-05-04','2029-05-05','2029-07-16','2029-08-11','2029-09-17','2029-09-23','2029-10-08','2029-11-03','2029-11-23',
      '2030-01-01','2030-01-14','2030-02-11','2030-02-23','2030-03-20','2030-04-29','2030-05-03','2030-05-04','2030-05-05','2030-07-15','2030-08-11','2030-09-16','2030-09-23','2030-10-14','2030-11-03','2030-11-23'
    ];
    let triviaData = {
      '01-01': '元日。新年の始まりを祝う日です。',
      '02-03': '節分。豆まきで鬼を追い払います。',
      '02-11': '建国記念の日。日本の建国を祝う日。',
      '02-14': 'バレンタインデー。チョコレートを贈る日。',
      '03-03': 'ひな祭り。女の子の健やかな成長を願う日。',
      '03-14': 'ホワイトデー。バレンタインのお返しを贈る日。',
      '04-01': 'エイプリルフール。嘘をついても許される日。',
      '04-29': '昭和の日。昭和天皇の誕生日。',
      '05-03': '憲法記念日。日本国憲法の施行を記念。',
      '05-04': 'みどりの日。自然に親しむ日。',
      '05-05': 'こどもの日。子どもの成長を祝う日。',
      '07-07': '七夕。織姫と彦星が出会う日。',
      '08-11': '山の日。山に親しむ機会を得る日。',
      '09-15': '敬老の日。お年寄りを敬う日。',
      '09-23': '秋分の日。昼と夜の長さがほぼ等しい日。',
      '10-10': '体育の日（旧）。スポーツに親しむ日。',
      '10-31': 'ハロウィン。仮装やお菓子を楽しむ日。',
      '11-03': '文化の日。自由と平和を愛する日。',
      '11-23': '勤労感謝の日。働くことに感謝する日。',
      '12-24': 'クリスマス・イブ。クリスマス前夜。',
      '12-25': 'クリスマス。イエス・キリストの誕生日。',
      '12-31': '大晦日。一年の締めくくりの日。',
      '06-11': '今日は「傘の日」。梅雨入りの時期にちなみ制定されました。',
      '03-20': '春分の日。昼と夜の長さがほぼ等しい日。',
      '02-23': '天皇誕生日。令和天皇の誕生日。'
    };
    // 外部JSONをfetchして上書き
    fetch('./holidays-ja.json').then(r=>r.ok?r.json():Promise.reject()).then(data=>{
      if(Array.isArray(data)) holidays = data;
    }).catch(()=>{/* フォールバック */});
    fetch('./date-trivia-ja.json').then(r=>r.ok?r.json():Promise.reject()).then(data=>{
      if(typeof data === 'object') triviaData = data;
    }).catch(()=>{/* フォールバック */});
    // --- 祝日・トリビア参照ロジックを修正 ---
    function isBusinessDay(dateStr) {
      const d = new Date(dateStr);
      const day = d.getDay();
      if (day === 0 || day === 6) return false; // 日曜・土曜
      if (holidays.includes(dateStr)) return false;
      return true;
    }
    function showDateTrivia(dateStr) {
      const triviaBox = document.getElementById('dateTrivia');
      // YYYY-MM-DD→MM-DD変換
      let key = dateStr && dateStr.length >= 10 ? dateStr.slice(5,10) : dateStr;
      if (triviaData[key]) {
        triviaBox.textContent = triviaData[key];
      } else {
        triviaBox.textContent = 'この日付に関する特別なトリビアはありません。';
      }
    }
    // 日付入力欄のいずれかが変更されたらトリビア表示
    ['startDate','endDate','baseDate','bizStartDate','bizEndDate'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('change', function() {
          if (el.value) showDateTrivia(el.value);
        });
      }
    });
    // 機能切り替えUI
    function updateSections() {
      const diffSection = document.getElementById('diffSection');
      const addsubSection = document.getElementById('addsubSection');
      const bizSection = document.getElementById('bizSection');
      const toggleDiff = document.getElementById('toggleDiff');
      const toggleAddSub = document.getElementById('toggleAddSub');
      const toggleBiz = document.getElementById('toggleBiz');
      
      if (diffSection && toggleDiff) {
        diffSection.style.display = toggleDiff.checked ? '' : 'none';
      }
      if (addsubSection && toggleAddSub) {
        addsubSection.style.display = toggleAddSub.checked ? '' : 'none';
      }
      if (bizSection && toggleBiz) {
        bizSection.style.display = toggleBiz.checked ? '' : 'none';
      }
    }
    
    const toggleDiff = document.getElementById('toggleDiff');
    const toggleAddSub = document.getElementById('toggleAddSub');
    const toggleBiz = document.getElementById('toggleBiz');
    
    if (toggleDiff) {
      toggleDiff.addEventListener('change', updateSections);
    }
    if (toggleAddSub) {
      toggleAddSub.addEventListener('change', updateSections);
    }
    if (toggleBiz) {
      toggleBiz.addEventListener('change', updateSections);
    }
    // 初期化
    updateSections();
  </script>
</body>
</html>

