<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' 
      https://cdn.tailwindcss.com 
      https://cdn.jsdelivr.net 
      https://unpkg.com
      https://www.googletagmanager.com
      https://pagead2.googlesyndication.com;
    style-src 'self' 'unsafe-inline' 
      https://fonts.googleapis.com 
      https://cdn.tailwindcss.com; 
    font-src 'self' 
      https://fonts.gstatic.com;
    img-src 'self' data: blob:
      https://pagead2.googlesyndication.com;
    connect-src 'self'
      https://www.google-analytics.com;
    frame-src 'self'
      https://googleads.g.doubleclick.net;
    worker-src 'self';
    object-src 'none'; 
    base-uri 'self';
  " />
  
  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
  
  <title>クリエイティブQRコード生成ツール - negi-lab.com</title>
  <meta name="description" content="従来の四角形に縛られない、自由な形・色・配置のクリエイティブQRコードを生成。テンプレート・バッチ生成・Wi-Fi・メール対応。無料で使いやすいQR作成ツール。" />
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            negi: "#65c155",
            accent: "#4ADE80"
          }
        }
      }
    };
  </script>

  <style>
    .form-input, .form-select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.875rem;
    }
    
    .download-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .download-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .download-btn:not(:disabled):hover {
      background: #4ADE80;
      color: white;
      border-color: #4ADE80;
    }
    
    .qr-template-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      background: white;
      border-radius: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .qr-template-btn:hover {
      border-color: #4ADE80;
      background: rgba(74, 222, 128, 0.05);
    }
    
    .qr-template-btn.active {
      border-color: #4ADE80;
      background: #f0fdf4;
      color: #4ADE80;
    }
    
    .preset-btn, .shape-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      background: white;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .preset-btn:hover, .shape-btn:hover {
      border-color: #4ADE80;
      background: rgba(74, 222, 128, 0.1);
    }
    
    .preset-btn.active, .shape-btn.active {
      border-color: #4ADE80;
      background: #f0fdf4;
      color: #4ADE80;
    }
    
    .mode-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      background: white;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .mode-btn.active {
      border-color: #4ADE80;
      background-color: #f0fdf4;
      color: #4ADE80;
    }
    
    .tab-btn {
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }
    
    .tab-btn.active {
      border-bottom-color: #4ADE80;
      color: #4ADE80;
      background-color: #f0fdf4;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col font-sans">
  
  <!-- ヘッダー -->
  <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="container mx-auto px-4">
      <nav class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-4">
          <a href="../index.html" class="text-xl font-bold text-negi">negi-lab.com</a>
        </div>
        <ul class="flex items-center space-x-4">
          <li>
            <button id="guide-btn" class="rounded border border-accent px-3 py-1 text-accent text-sm font-semibold bg-white hover:bg-accent/10 focus:outline-none focus:ring-2 focus:ring-accent transition">ガイド</button>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="flex-grow py-12">
    <div class="container mx-auto px-4 max-w-6xl">
      
      <!-- ヘッダー -->
      <div class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">クリエイティブQRコード生成ツール</h1>
        <p class="text-gray-600 text-lg max-w-3xl mx-auto">
          従来の四角形に縛られない、自由な形・色・配置のQRコードを作成。テンプレート・バッチ生成・Wi-Fi・メール等に対応。
        </p>
      </div>
      
      <!-- メインコンテンツ -->
      <div class="grid lg:grid-cols-3 gap-6">
        
        <!-- 左側: クイック設定 -->
        <div class="lg:col-span-1 space-y-4">
          
          <!-- 生成モード -->
          <div class="bg-white rounded-xl shadow-lg p-4 border border-gray-100">
            <h3 class="text-lg font-semibold mb-3 text-gray-800">生成モード</h3>
            <div class="flex gap-2">
              <button id="singleModeBtn" class="mode-btn active flex-1" data-mode="single">
                <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="text-xs">単体</span>
              </button>
              <button id="batchModeBtn" class="mode-btn flex-1" data-mode="batch">
                <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
                <span class="text-xs">バッチ</span>
              </button>
            </div>
          </div>

          <!-- 単体生成セクション -->
          <div id="singleGenerationSection" class="bg-white rounded-xl shadow-lg p-4 border border-gray-100">
            <h3 class="text-lg font-semibold mb-3 text-gray-800">データ種別</h3>
            <div class="grid grid-cols-2 gap-2">
              <button class="qr-template-btn active" data-template="text">
                <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="text-xs font-medium">テキスト</span>
              </button>
              <button class="qr-template-btn" data-template="url">
                <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                <span class="text-xs font-medium">URL</span>
              </button>
              <button class="qr-template-btn" data-template="wifi">
                <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                </svg>
                <span class="text-xs font-medium">Wi-Fi</span>
              </button>
              <button class="qr-template-btn" data-template="email">
                <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <span class="text-xs font-medium">メール</span>
              </button>
            </div>
          </div>

          <!-- バッチ生成セクション -->
          <div id="batchGenerationSection" class="bg-white rounded-xl shadow-lg p-4 border border-gray-100" style="display: none;">
            <h3 class="text-lg font-semibold mb-3 text-gray-800">バッチ生成</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">CSVデータ</label>
                <textarea id="batchData" class="form-input" rows="5" placeholder="テキスト1,名前1
テキスト2,名前2
テキスト3,名前3"></textarea>
                <p class="text-xs text-gray-500 mt-1">1行ごとに「テキスト,ファイル名」の形式で入力</p>
              </div>
              <button id="batchGenerateBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                一括生成
              </button>
            </div>
          </div>

        </div>

        <!-- 中央: 設定タブ -->
        <div class="lg:col-span-1 space-y-4">
          
          <!-- タブナビゲーション -->
          <div class="bg-white rounded-xl shadow-lg border border-gray-100">
            <div class="flex border-b border-gray-200">
              <button class="tab-btn active flex-1 py-3 px-4 text-sm font-medium" data-tab="basic">基本</button>
              <button class="tab-btn flex-1 py-3 px-4 text-sm font-medium" data-tab="creative">デザイン</button>
              <button class="tab-btn flex-1 py-3 px-4 text-sm font-medium" data-tab="advanced">高度</button>
            </div>

            <!-- タブコンテンツ -->
            <div class="p-4">
              
              <!-- 基本タブ -->
              <div id="basic-tab" class="tab-content active">
                <div class="space-y-4">
                  <!-- テキスト入力 -->
                  <div id="textInput" class="template-input">
                    <label class="block text-sm font-medium text-gray-700 mb-1">内容</label>
                    <textarea id="qrText" class="form-input" rows="3" placeholder="QRコードにしたいテキストやURLを入力"></textarea>
                  </div>
                  
                  <!-- Wi-Fi入力 -->
                  <div id="wifiInput" class="template-input hidden">
                    <div class="space-y-2">
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">ネットワーク名</label>
                        <input type="text" id="wifiSSID" class="form-input text-sm" placeholder="Wi-Fiネットワーク名">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">パスワード</label>
                        <input type="text" id="wifiPassword" class="form-input text-sm" placeholder="Wi-Fiパスワード">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">セキュリティ</label>
                        <select id="wifiSecurity" class="form-select text-sm">
                          <option value="WPA">WPA/WPA2</option>
                          <option value="WEP">WEP</option>
                          <option value="">なし</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <!-- メール入力 -->
                  <div id="emailInput" class="template-input hidden">
                    <div class="space-y-2">
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">メールアドレス</label>
                        <input type="email" id="emailAddress" class="form-input text-sm" placeholder="example@domain.com">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">件名</label>
                        <input type="text" id="emailSubject" class="form-input text-sm" placeholder="メール件名">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">本文</label>
                        <textarea id="emailBody" class="form-input text-sm" rows="2" placeholder="メール本文"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- デザインタブ -->
              <div id="creative-tab" class="tab-content">
                <div class="space-y-4">
                  
                  <!-- プリセット選択 -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">プリセット</label>
                    <div class="grid grid-cols-2 gap-2">
                      <button class="preset-btn active text-xs py-2" data-preset="default">
                        <div class="w-4 h-4 bg-black mx-auto mb-1 rounded-sm"></div>
                        スタンダード
                      </button>
                      <button class="preset-btn text-xs py-2" data-preset="round">
                        <div class="w-4 h-4 bg-blue-500 mx-auto mb-1 rounded-full"></div>
                        ラウンド
                      </button>
                      <button class="preset-btn text-xs py-2" data-preset="gradient">
                        <div class="w-4 h-4 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto mb-1 rounded-sm"></div>
                        グラデーション
                      </button>
                      <button class="preset-btn text-xs py-2" data-preset="minimal">
                        <div class="w-4 h-4 border-2 border-gray-400 mx-auto mb-1 rounded-sm"></div>
                        ミニマル
                      </button>
                    </div>
                  </div>

                  <!-- セル形状 -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">セル形状</label>
                    <div class="grid grid-cols-4 gap-1">
                      <button class="shape-btn active text-xs py-1" data-cell-shape="square">□</button>
                      <button class="shape-btn text-xs py-1" data-cell-shape="circle">○</button>
                      <button class="shape-btn text-xs py-1" data-cell-shape="rounded">▢</button>
                      <button class="shape-btn text-xs py-1" data-cell-shape="diamond">◇</button>
                    </div>
                  </div>

                  <!-- 色設定 -->
                  <div class="space-y-2">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">前景色</label>
                      <div class="flex gap-2 items-center">
                        <input type="color" id="foregroundColor" value="#000000" class="w-8 h-8 rounded border">
                        <span class="text-xs text-gray-500">QRコードの色</span>
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">背景色</label>
                      <div class="flex gap-2 items-center">
                        <input type="color" id="backgroundColor" value="#ffffff" class="w-8 h-8 rounded border">
                        <span class="text-xs text-gray-500">背景の色</span>
                      </div>
                    </div>
                  </div>

                  <!-- グラデーション設定 -->
                  <div>
                    <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                      <input type="checkbox" id="enableGradient" class="rounded">
                      グラデーション
                    </label>
                    <div id="gradientControls" class="space-y-2 opacity-50">
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">開始色</label>
                        <input type="color" id="gradientStart" value="#4f46e5" class="w-8 h-8 rounded border">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">終了色</label>
                        <input type="color" id="gradientEnd" value="#06b6d4" class="w-8 h-8 rounded border">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">方向</label>
                        <select id="gradientDirection" class="form-select text-xs">
                          <option value="to-r">左→右</option>
                          <option value="to-br">左上→右下</option>
                          <option value="to-b">上→下</option>
                          <option value="to-bl">右上→左下</option>
                        </select>
                      </div>
                    </div>
                  </div>

                </div>
              </div>

              <!-- 高度タブ -->
              <div id="advanced-tab" class="tab-content">
                <div class="space-y-4">
                  
                  <!-- サイズ・品質 -->
                  <div class="space-y-2">
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">サイズ</label>
                      <select id="qrSize" class="form-select text-sm">
                        <option value="200">200×200</option>
                        <option value="300">300×300</option>
                        <option value="400" selected>400×400</option>
                        <option value="500">500×500</option>
                        <option value="800">800×800</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-gray-700 mb-1">エラー訂正</label>
                      <select id="errorCorrection" class="form-select text-sm">
                        <option value="L">低（7%）</option>
                        <option value="M" selected>中（15%）</option>
                        <option value="Q">高（25%）</option>
                        <option value="H">最高（30%）</option>
                      </select>
                    </div>
                  </div>

                </div>
              </div>

            </div>
          </div>

          <!-- 生成ボタン -->
          <button id="generateBtn" class="w-full bg-gradient-to-r from-accent to-green-500 hover:from-green-500 hover:to-accent text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            QRコードを生成
          </button>

        </div>

        <!-- 右側: プレビュー -->
        <div class="lg:col-span-1 space-y-4">
          
          <!-- QRコード表示 -->
          <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
            <h3 class="text-lg font-semibold mb-4 text-gray-800">プレビュー</h3>
            <div id="qrResult" class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-8 text-center min-h-[300px] flex items-center justify-center">
              <div class="text-gray-500">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4zM18 14h2v2h-2zM16 16h2v2h-2zM18 18h2v2h-2z"></path>
                </svg>
                <p class="text-sm">QRコードがここに表示されます</p>
              </div>
            </div>
          </div>

          <!-- ダウンロードエリア -->
          <div class="bg-white rounded-xl shadow-lg p-4 border border-gray-100">
            <h4 class="text-md font-semibold mb-3 text-gray-800">ダウンロード</h4>
            <div class="grid grid-cols-2 gap-2">
              <button id="downloadPNG" class="download-btn" disabled>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                PNG
              </button>
              <button id="downloadJPEG" class="download-btn" disabled>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                JPEG
              </button>
              <button id="downloadSVG" class="download-btn" disabled>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                SVG
              </button>
              <button id="downloadCreative" class="download-btn" disabled>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                </svg>
                クリエイティブ
              </button>
            </div>
          </div>

        </div>
      </div>

    </div>
  </main>

  <!-- ガイドモーダル -->
  <div id="guide-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-4xl max-h-[80vh] overflow-y-auto mx-4">
      <div class="flex justify-between items-start mb-4">
        <h2 class="text-2xl font-bold text-gray-900">QRコード生成ツールの使い方</h2>
        <button id="guide-close" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div id="guide-modal-content" class="space-y-6">
        <div class="border border-gray-200 rounded-lg p-4">
          <h3 class="text-lg font-semibold mb-3 text-gray-800">基本的な使い方</h3>
          <ol class="list-decimal list-inside space-y-2 text-gray-700">
            <li class="text-sm">左側でデータ種別（テキスト、URL、Wi-Fiなど）を選択</li>
            <li class="text-sm">中央の基本タブで必要な情報を入力</li>
            <li class="text-sm">デザインタブでプリセットや色を調整（お好みで）</li>
            <li class="text-sm">「QRコードを生成」ボタンをクリック</li>
            <li class="text-sm">右側にプレビューが表示されたらダウンロード</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- フッター -->
  <footer class="bg-gray-800 text-gray-300 py-8 text-center text-sm">
    <nav class="mb-2">
      <a href="/privacy-policy-unified.html" class="underline hover:text-accent mx-2">プライバシーポリシー</a>
      <a href="/terms.html" class="underline hover:text-accent mx-2">利用規約</a>
      <a href="/about.html" class="underline hover:text-accent mx-2">運営者情報</a>
    </nav>
    <div>&copy; 2025 negi-lab.com</div>
  </footer>

  <!-- QRコードライブラリ -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <!-- 簡易QRGeneratorクラス -->
  <script>
    class QRGenerator {
      constructor() {
        this.currentTemplate = 'text';
        this.currentMode = 'single';
        this.currentCellShape = 'square';
        this.currentPreset = 'default';
        this.gradientEnabled = false;
        this.colors = {
          foreground: '#000000',
          background: '#ffffff',
          gradientStart: '#4f46e5',
          gradientEnd: '#06b6d4'
        };
        this.qrSize = 400;
        this.errorCorrectionLevel = 'M';
        console.log('✅ QRGenerator初期化完了');
      }

      setMode(mode) {
        this.currentMode = mode;
        console.log('Mode set to:', mode);
      }

      setTemplate(template) {
        this.currentTemplate = template;
        console.log('Template set to:', template);
      }

      setPreset(preset) {
        this.currentPreset = preset;
        this.applyPreset(preset);
        console.log('Preset set to:', preset);
      }

      setCellShape(shape) {
        this.currentCellShape = shape;
        console.log('Cell shape set to:', shape);
      }

      setForegroundColor(color) {
        this.colors.foreground = color;
      }

      setBackgroundColor(color) {
        this.colors.background = color;
      }

      setGradientEnabled(enabled) {
        this.gradientEnabled = enabled;
      }

      setGradientStart(color) {
        this.colors.gradientStart = color;
      }

      setGradientEnd(color) {
        this.colors.gradientEnd = color;
      }

      setSize(size) {
        this.qrSize = size;
      }

      setErrorCorrection(level) {
        this.errorCorrectionLevel = level;
      }

      applyPreset(preset) {
        switch(preset) {
          case 'default':
            this.currentCellShape = 'square';
            this.gradientEnabled = false;
            this.colors.foreground = '#000000';
            this.colors.background = '#ffffff';
            break;
          case 'round':
            this.currentCellShape = 'circle';
            this.gradientEnabled = false;
            this.colors.foreground = '#2563eb';
            this.colors.background = '#ffffff';
            break;
          case 'gradient':
            this.currentCellShape = 'square';
            this.gradientEnabled = true;
            this.colors.gradientStart = '#8b5cf6';
            this.colors.gradientEnd = '#ec4899';
            break;
          case 'minimal':
            this.currentCellShape = 'square';
            this.gradientEnabled = false;
            this.colors.foreground = '#6b7280';
            this.colors.background = '#ffffff';
            break;
        }
      }

      collectInputData() {
        switch(this.currentTemplate) {
          case 'text':
          case 'url':
            const textElement = document.getElementById('qrText');
            return textElement ? textElement.value : '';
            
          case 'wifi':
            const ssid = document.getElementById('wifiSSID')?.value || '';
            const password = document.getElementById('wifiPassword')?.value || '';
            const security = document.getElementById('wifiSecurity')?.value || 'WPA';
            return `WIFI:T:${security};S:${ssid};P:${password};;`;
            
          case 'email':
            const email = document.getElementById('emailAddress')?.value || '';
            const subject = document.getElementById('emailSubject')?.value || '';
            const body = document.getElementById('emailBody')?.value || '';
            return `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
          default:
            return '';
        }
      }

      async generate() {
        console.log('🔧 QR生成開始');
        
        try {
          const data = this.collectInputData();
          if (!data || !data.trim()) {
            console.warn('⚠️ 生成データが空です');
            return;
          }

          const qrResult = document.getElementById('qrResult');
          if (!qrResult) {
            console.error('❌ qrResult要素が見つかりません');
            return;
          }

          console.log('📝 生成データ:', data);

          // ローディング表示
          qrResult.innerHTML = '<div class="text-center text-gray-500"><div class="animate-spin w-8 h-8 border-4 border-accent border-t-transparent rounded-full mx-auto mb-2"></div><p class="text-sm">生成中...</p></div>';

          // QRコード生成
          if (typeof QRCode !== 'undefined' && QRCode.toDataURL) {
            QRCode.toDataURL(data, {
              width: this.qrSize,
              height: this.qrSize,
              errorCorrectionLevel: this.errorCorrectionLevel,
              color: {
                dark: this.colors.foreground,
                light: this.colors.background
              }
            }, (err, url) => {
              if (err) {
                console.error('QRCode生成エラー:', err);
                qrResult.innerHTML = `<div class="text-red-500 p-4">エラー: ${err.message}</div>`;
              } else {
                const img = document.createElement('img');
                img.src = url;
                img.className = 'mx-auto max-w-full h-auto';
                qrResult.innerHTML = '';
                qrResult.appendChild(img);
                
                // ダウンロードボタンを有効化
                this.enableDownloadButtons();
                console.log('✅ QRコード生成完了');
              }
            });
          } else {
            console.error('❌ QRCodeライブラリが利用できません');
            qrResult.innerHTML = '<div class="text-red-500 p-4">QRCodeライブラリが読み込まれていません</div>';
          }

        } catch (error) {
          console.error('❌ QRコード生成エラー:', error);
          const qrResult = document.getElementById('qrResult');
          if (qrResult) {
            qrResult.innerHTML = `<div class="text-red-500 p-4">エラー: ${error.message}</div>`;
          }
        }
      }

      enableDownloadButtons() {
        const downloadPNG = document.getElementById('downloadPNG');
        const downloadJPEG = document.getElementById('downloadJPEG');
        const downloadSVG = document.getElementById('downloadSVG');
        const downloadCreative = document.getElementById('downloadCreative');
        
        if (downloadPNG) downloadPNG.disabled = false;
        if (downloadJPEG) downloadJPEG.disabled = false;
        if (downloadSVG) downloadSVG.disabled = false;
        if (downloadCreative) downloadCreative.disabled = false;
      }

      disableDownloadButtons() {
        const downloadPNG = document.getElementById('downloadPNG');
        const downloadJPEG = document.getElementById('downloadJPEG');
        const downloadSVG = document.getElementById('downloadSVG');
        const downloadCreative = document.getElementById('downloadCreative');
        
        if (downloadPNG) downloadPNG.disabled = true;
        if (downloadJPEG) downloadJPEG.disabled = true;
        if (downloadSVG) downloadSVG.disabled = true;
        if (downloadCreative) downloadCreative.disabled = true;
      }

      downloadPNG() {
        this.downloadAsFormat('png');
      }

      downloadJPEG() {
        this.downloadAsFormat('jpeg');
      }

      downloadSVG() {
        this.downloadAsFormat('svg');
      }

      downloadCreative() {
        this.downloadAsFormat('png');
      }

      downloadAsFormat(format) {
        const qrResult = document.getElementById('qrResult');
        const img = qrResult.querySelector('img');
        
        if (img) {
          const link = document.createElement('a');
          link.href = img.src;
          link.download = `qrcode.${format}`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }
      }

      async generateBatch() {
        const batchDataElement = document.getElementById('batchData');
        if (!batchDataElement) return;
        
        const batchText = batchDataElement.value.trim();
        if (!batchText) {
          alert('バッチデータを入力してください');
          return;
        }
        
        const lines = batchText.split('\n').filter(line => line.trim());
        
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          const [text, filename] = line.split(',').map(s => s.trim());
          if (text) {
            try {
              const dataURL = await this.generateQRData(text);
              setTimeout(() => {
                const link = document.createElement('a');
                link.href = dataURL;
                link.download = `${filename || `qr_${i+1}`}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
              }, i * 500);
            } catch (error) {
              console.error(`バッチ生成エラー (${text}):`, error);
            }
          }
        }
        
        alert(`${lines.length}個のQRコードの生成を開始しました。ダウンロードが順次実行されます。`);
      }

      generateQRData(text) {
        return new Promise((resolve, reject) => {
          if (typeof QRCode !== 'undefined' && QRCode.toDataURL) {
            QRCode.toDataURL(text, {
              width: this.qrSize,
              height: this.qrSize,
              errorCorrectionLevel: this.errorCorrectionLevel,
              color: {
                dark: this.colors.foreground,
                light: this.colors.background
              }
            }, (err, url) => {
              if (err) reject(err);
              else resolve(url);
            });
          } else {
            reject(new Error('QRCode library not available'));
          }
        });
      }
    }

    // グローバルに公開
    window.QRGenerator = QRGenerator;
  </script>

  <!-- UI制御スクリプト -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      console.log('🚀 DOM読み込み完了、UI初期化開始');
      
      // QRGeneratorのインスタンスを生成
      const qrGenerator = new QRGenerator();
      window.qrGenerator = qrGenerator;

      // --- UI要素の参照 ---
      const singleModeBtn = document.getElementById('singleModeBtn');
      const batchModeBtn = document.getElementById('batchModeBtn');
      const singleGenerationSection = document.getElementById('singleGenerationSection');
      const batchGenerationSection = document.getElementById('batchGenerationSection');
      const templateButtons = document.querySelectorAll('.qr-template-btn');
      const templateInputs = document.querySelectorAll('.template-input');
      const generateBtn = document.getElementById('generateBtn');
      const batchGenerateBtn = document.getElementById('batchGenerateBtn');
      
      // ダウンロードボタン
      const downloadPNG = document.getElementById('downloadPNG');
      const downloadJPEG = document.getElementById('downloadJPEG');
      const downloadSVG = document.getElementById('downloadSVG');
      const downloadCreative = document.getElementById('downloadCreative');
      
      // プリセットとシェイプボタン
      const presetButtons = document.querySelectorAll('.preset-btn');
      const cellShapeButtons = document.querySelectorAll('.shape-btn[data-cell-shape]');
      
      // カラー設定
      const foregroundColor = document.getElementById('foregroundColor');
      const backgroundColor = document.getElementById('backgroundColor');
      const enableGradient = document.getElementById('enableGradient');
      const gradientStart = document.getElementById('gradientStart');
      const gradientEnd = document.getElementById('gradientEnd');
      
      // 高度な設定
      const qrSize = document.getElementById('qrSize');
      const errorCorrection = document.getElementById('errorCorrection');

      // --- ヘルパー関数 ---
      const updateActiveButton = (buttons, activeButton) => {
        buttons.forEach(btn => btn.classList.remove('active'));
        activeButton.classList.add('active');
      };

      // --- イベントリスナー ---

      // 1. 生成モード切替
      if (singleModeBtn) {
        singleModeBtn.addEventListener('click', () => {
          qrGenerator.setMode('single');
          updateActiveButton([singleModeBtn, batchModeBtn], singleModeBtn);
          if (singleGenerationSection) singleGenerationSection.style.display = 'block';
          if (batchGenerationSection) batchGenerationSection.style.display = 'none';
        });
      }

      if (batchModeBtn) {
        batchModeBtn.addEventListener('click', () => {
          qrGenerator.setMode('batch');
          updateActiveButton([singleModeBtn, batchModeBtn], batchModeBtn);
          if (singleGenerationSection) singleGenerationSection.style.display = 'none';
          if (batchGenerationSection) batchGenerationSection.style.display = 'block';
        });
      }

      // 2. テンプレート選択
      templateButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const template = btn.dataset.template;
          qrGenerator.setTemplate(template);
          updateActiveButton(templateButtons, btn);

          templateInputs.forEach(input => {
            input.style.display = input.id === `${template}Input` ? 'block' : 'none';
          });
        });
      });

      // 3. プリセット選択
      presetButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const preset = btn.dataset.preset;
          qrGenerator.setPreset(preset);
          updateActiveButton(presetButtons, btn);
        });
      });

      // 4. セル形状選択
      cellShapeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const shape = btn.dataset.cellShape;
          qrGenerator.setCellShape(shape);
          updateActiveButton(cellShapeButtons, btn);
        });
      });

      // 5. 色設定
      if (foregroundColor) {
        foregroundColor.addEventListener('change', () => {
          qrGenerator.setForegroundColor(foregroundColor.value);
        });
      }

      if (backgroundColor) {
        backgroundColor.addEventListener('change', () => {
          qrGenerator.setBackgroundColor(backgroundColor.value);
        });
      }

      // 6. グラデーション設定
      if (enableGradient) {
        enableGradient.addEventListener('change', () => {
          qrGenerator.setGradientEnabled(enableGradient.checked);
          const gradientControls = document.getElementById('gradientControls');
          if (gradientControls) {
            if (enableGradient.checked) {
              gradientControls.classList.remove('opacity-50');
              gradientControls.style.pointerEvents = 'auto';
            } else {
              gradientControls.classList.add('opacity-50');
              gradientControls.style.pointerEvents = 'none';
            }
          }
        });
      }

      if (gradientStart) {
        gradientStart.addEventListener('change', () => {
          qrGenerator.setGradientStart(gradientStart.value);
        });
      }

      if (gradientEnd) {
        gradientEnd.addEventListener('change', () => {
          qrGenerator.setGradientEnd(gradientEnd.value);
        });
      }

      // 7. 高度な設定
      if (qrSize) {
        qrSize.addEventListener('change', () => {
          qrGenerator.setSize(parseInt(qrSize.value));
        });
      }

      if (errorCorrection) {
        errorCorrection.addEventListener('change', () => {
          qrGenerator.setErrorCorrection(errorCorrection.value);
        });
      }

      // 8. 生成ボタン
      if (generateBtn) {
        generateBtn.addEventListener('click', () => {
          qrGenerator.disableDownloadButtons();
          qrGenerator.generate();
        });
      }

      // 9. バッチ生成ボタン
      if (batchGenerateBtn) {
        batchGenerateBtn.addEventListener('click', () => {
          qrGenerator.generateBatch();
        });
      }

      // 10. ダウンロードボタン
      if (downloadPNG) {
        downloadPNG.addEventListener('click', () => qrGenerator.downloadPNG());
      }

      if (downloadJPEG) {
        downloadJPEG.addEventListener('click', () => qrGenerator.downloadJPEG());
      }

      if (downloadSVG) {
        downloadSVG.addEventListener('click', () => qrGenerator.downloadSVG());
      }

      if (downloadCreative) {
        downloadCreative.addEventListener('click', () => qrGenerator.downloadCreative());
      }

      // 11. タブ機能
      const tabBtns = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const targetTab = btn.getAttribute('data-tab');
          
          // すべてのタブボタンとコンテンツから active クラスを削除
          tabBtns.forEach(b => b.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // クリックされたタブボタンとコンテンツに active クラスを追加
          btn.classList.add('active');
          document.getElementById(targetTab + '-tab').classList.add('active');
        });
      });

      // 12. ガイドモーダル
      const guideBtn = document.getElementById('guide-btn');
      const guideModal = document.getElementById('guide-modal');
      const guideClose = document.getElementById('guide-close');
      
      if (guideBtn && guideModal && guideClose) {
        guideBtn.addEventListener('click', () => {
          guideModal.classList.remove('hidden');
        });
        
        guideClose.addEventListener('click', () => {
          guideModal.classList.add('hidden');
        });
        
        guideModal.addEventListener('click', (e) => {
          if (e.target === guideModal) {
            guideModal.classList.add('hidden');
          }
        });
      }

      // 13. 初期設定
      console.log('🎯 初期設定開始');
      
      // デフォルトでテキストテンプレートを選択
      const defaultTemplate = document.querySelector('.qr-template-btn[data-template="text"]');
      if (defaultTemplate) {
        defaultTemplate.click();
        console.log('✅ デフォルトテンプレート設定完了');
      }
      
      // 初期状態でダウンロードボタンを無効化
      qrGenerator.disableDownloadButtons();
      
      console.log('✅ QR Generator UI初期化完了');
    });
  </script>

</body>
</html>
